!function(){"use strict";angular.module("app",["ngRoute","mobile-angular-ui","angular-loading-bar","app.main","app.home","ngNotify","app.user","app.necesidad","mobile-angular-ui.gestures"]).run(["$transform",function(e){window.$transform=e}]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"scripts/home/home.html",reloadOnSearch:!1}).when("/",{templateUrl:"scripts/home/scroll.html",reloadOnSearch:!1,controller:"HomeCtrl",controllerAs:"HomeCtrl"}).when("/necesidad/:id",{templateUrl:"scripts/necesidad/detalle.html",controller:"NecesidadDetalleCtrl",controllerAs:"DetalleCtrl"}).when("/necesidad/:id/editar",{templateUrl:"scripts/necesidad/editar.html",controller:"NecesidadDetalleCtrl",controllerAs:"DetalleCtrl"}).when("/categoria/:categoria",{templateUrl:"scripts/necesidad/categoria.html",reloadOnSearch:!1,controller:"CategoriaCtrl",controllerAs:"CategoriaCtrl"}).when("/perfil",{templateUrl:"scripts/users/config.html",reloadOnSearch:!1,controller:"ConfigCtrl",controllerAs:"ConfigCtrl"}).when("/usuario/:id",{templateUrl:"scripts/users/profile.html",reloadOnSearch:!1,controller:"UserCtrl",controllerAs:"UserCtrl"}).when("/contacto",{templateUrl:"scripts/shared/contacto.html"}).when("/privacidad",{templateUrl:"scripts/shared/privacidad.html"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("app.home",[]).controller("HomeCtrl",["Necesidad","ngNotify",function(e,r){var t=this;e.load().success(function(e){t.necesidades=e}).error(function(e){r.set(e,"error")})}])}(),function(){"use strict";angular.module("app.necesidad.categoria",[]).controller("CategoriaCtrl",["Necesidad","$routeParams",function(e,r){var t=this;e.categoria(r.categoria).success(function(e){t.necesidades=e.necesidades,t.categoria=e.categoria}).error(function(e){console.error(e)})}])}(),function(){"use strict";angular.module("app.comentario.service",[]).factory("Comentario",["$http",function(e){return{"delete":function(r){return e["delete"]("/api/comentarios/"+r)},util:function(r){return e.patch("/api/comentarios/"+r)},create:function(r){return e({data:r,method:"POST",url:"/api/necesidades/"+r.necesidadId+"/comentarios"})},update:function(r){return e({data:r,method:"PUT",url:"/api/comentarios/"+r.id})}}}])}(),function(){"use strict";angular.module("app.necesidad.detalle",[]).controller("NecesidadDetalleCtrl",["Necesidad","ngNotify","$routeParams","$window","Comentario","$scope",function(e,r,t,n,o,i){var a=this;a.necesidad={},a.Comentario={},t.id&&e.show(t.id).success(function(e){a.necesidad=e}).error(function(e){r.set(e,"error")}),a.save=function(){e.update(a.necesidad).success(function(e){r.set(e,"success")}).error(function(e){r.set(e,"error")})},a.comentar=function(){a.ComentarioForm.necesidadId=a.necesidad.id,o.create(a.ComentarioForm).success(function(e){r.set(e,"success"),a.Comentario.createdAt=new Date,a.necesidad.comentarios.push(a.Comentario),a.Comentario={}}).error(function(e){r.set(e,"error")})},a["delete"]=function(){var t=confirm("Realmente deseas eliminar esta publicaciÃ³n?");t&&e["delete"](a.necesidad.id).success(function(e){r.set(e,"success"),n.location="#/"}).error(function(e){r.set(e,"error")})},a.util=function(e){o.util(e.id).success(function(t){e.util=!0,r.set(t,"success")}).error(function(e){r.set(e,"error")})},i.upload=function(n){console.log("Subiendo archivo");var o=new FormData;n[0]&&(o.append("file",n[0]),e.upload(o,t.id).success(function(e){r.set(e,"success"),console.log(e)}).error(function(e){console.log(e),r.set(e,"error")}))}}])}(),function(){"use strict";angular.module("app.necesidad.item",[]).directive("necesidadItem",function(){return{restrict:"E",templateUrl:"scripts/necesidad/item.html",scope:{necesidad:"="}}})}(),function(){"use strict";angular.module("app.necesidad",["app.necesidad.service","app.necesidad.nueva","app.necesidad.item","app.necesidad.detalle","app.necesidad.categoria","app.comentario.service"]).controller("NecesidadesCtrl",["Necesidad","ngNotify",function(e,r){var t=this;e.load().success(function(e){t.necesidades=e}).error(function(e){r.set(e,"error")})}])}(),function(){"use strict";angular.module("app.necesidad.service",[]).factory("Necesidad",["$http",function(e){return{load:function(r){return e.get("/api/necesidades")},show:function(r){return e.get("/api/necesidades/"+r)},categoria:function(r){return e.get("/api/categorias/"+r)},"delete":function(r){return e["delete"]("/api/necesidades/"+r)},create:function(r){return e({data:r,method:"POST",url:"/api/necesidades"})},upload:function(r,t){return e.post("/api/necesidades/"+t+"/upload",r,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity})},update:function(r){return e({data:r,method:"PUT",url:"/api/necesidades/"+r.id})}}}])}(),function(){"use strict";angular.module("app.necesidad.nueva",[]).directive("nuevaNecesidad",["Necesidad","ngNotify","$window",function(e,r,t){return{restrict:"E",templateUrl:"scripts/necesidad/nueva.html",scope:{user:"="},controllerAs:"NuevaNecesidadCtrl",bindToController:!0,controller:"NuevaNecesidadCtrl"}}]).controller("NuevaNecesidadCtrl",["Necesidad","ngNotify","$window",function(e,r,t){var n=this;n.NecesidadForm={},n.create=function(){e.create(n.NecesidadForm).success(function(e){r.set("Necesidad agregada correctamente :)","success"),t.location="#/necesidad/"+e+"/editar"}).error(function(e){r.set(e,"error")})}}])}(),angular.module("app.directives",[]).directive("money",function(){function e(e,t,n,o){function i(e){var r=Math.pow(10,l);return Math.round(e*r)/r}function a(e){return parseFloat(e).toFixed(l)}function s(e){return o.$isEmpty(e)?"":""+e}var c,u=parseFloat(n.min||0),l=parseFloat(n.precision||2);o.$parsers.push(function(e){angular.isUndefined(e)&&(e=""),0===e.indexOf(".")&&(e="0"+e),0===e.indexOf("-")&&(u>=0?(e=null,o.$setViewValue(""),o.$render()):"-"===e&&(e=""));var t=o.$isEmpty(e);return t||r.test(e)?c=""===e?null:t?e:parseFloat(e):(o.$setViewValue(s(c)),o.$render()),o.$setValidity("number",!0),c}),o.$formatters.push(s);var d=function(e){return!o.$isEmpty(e)&&u>e?void o.$setValidity("min",!1):(o.$setValidity("min",!0),e)};if(o.$parsers.push(d),o.$formatters.push(d),n.max){var p=parseFloat(n.max),f=function(e){return!o.$isEmpty(e)&&e>p?void o.$setValidity("max",!1):(o.$setValidity("max",!0),e)};o.$parsers.push(f),o.$formatters.push(f)}l>-1&&(o.$parsers.push(function(e){return e?i(e):e}),o.$formatters.push(function(e){return e?a(e):e})),t.bind("blur",function(){var e=o.$modelValue;e&&(o.$viewValue=a(e),o.$render())})}var r=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:e}}).directive("numbersOnly",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,n){n.$parsers.push(function(e){if(void 0===e)return"";var r=e.replace(/[^0-9+.]/g,"");return r!==e&&(n.$setViewValue(r),n.$render()),r})}}}),angular.module("app.filters",[]).filter("dinero",["$filter","$locale",function(e,r){var t=e("currency"),n=r.NUMBER_FORMATS;return function(e,r,o){0===r&&(r=-1);var i=t(e,o),a=i.indexOf(n.DECIMAL_SEP)+1,s="";return a<i.indexOf(n.CURRENCY_SYM)&&(s=" "+n.CURRENCY_SYM),i.substring(0,a+r)+s}}]),function(){"use strict";angular.module("app.main",["app.directives","app.filters"]).controller("MainController",["$rootScope","$scope","User",function(e,r,t){var n=this;t.me().success(function(e){n.user=e}).error(function(e){console.log(e)}),r.userAgent=navigator.userAgent,e.$on("$routeChangeStart",function(){e.loading=!0}),e.$on("$routeChangeSuccess",function(){e.loading=!1}),r.bottomReached=function(){},r.notices=[];for(var o=0;10>o;o++)r.notices.push({icon:"envelope",message:"Notice "+(o+1)});r.deleteNotice=function(e){var t=r.notices.indexOf(e);t>-1&&r.notices.splice(t,1)}}])}(),function(){"use strict";angular.module("app.user.config",[]).controller("ConfigCtrl",["ngNotify","User",function(e,r){var t=this;t.user={},console.log("Cargando"),r.me().success(function(e){t.user=e}).error(function(r){e.set(r,"error")}),t.save=function(){r.update(t.user).success(function(r){e.set(r,"success")}).error(function(r){e.set(r,"error")})}}])}(),function(){"use strict";angular.module("app.user",["app.user.service","app.user.config"]).controller("UserCtrl",["ngNotify","User","$routeParams",function(e,r,t){var n=this;console.log("Cargando"),r.show(t.id).success(function(e){n.user=e,console.log("no"),console.log(e)}).error(function(r){e.set(r,"error")})}])}(),function(){"use strict";angular.module("app.user.service",[]).factory("User",["$http",function(e){return{me:function(){return e.get("/api/users/profile")},update:function(r){return e({method:"PUT",data:r,url:"/api/users/profile"})},show:function(r){return e.get("/api/users/"+r)}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwibmVjZXNpZGFkL2NhdGVnb3JpYS5jb250cm9sbGVyLmpzIiwibmVjZXNpZGFkL2NvbWVudGFyaW8uc2VydmljZS5qcyIsIm5lY2VzaWRhZC9kZXRhbGxlLmNvbnRyb2xsZXIuanMiLCJuZWNlc2lkYWQvaXRlbS5kaXJlY3RpdmUuanMiLCJuZWNlc2lkYWQvbmVjZXNpZGFkLmNvbnRyb2xsZXIuanMiLCJuZWNlc2lkYWQvbmVjZXNpZGFkLnNlcnZpY2UuanMiLCJuZWNlc2lkYWQvbnVldmEuY29udHJvbGxlci5qcyIsInNoYXJlZC9kaXJlY3RpdmVzLmpzIiwic2hhcmVkL2ZpbHRlcnMuanMiLCJzaGFyZWQvbWFpbi5qcyIsInVzZXJzL2NvbmZpZy5jb250cm9sbGVyLmpzIiwidXNlcnMvY29udHJvbGxlci5qcyIsInVzZXJzL3NlcnZpY2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsInJ1biIsIiR0cmFuc2Zvcm0iLCJ3aW5kb3ciLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInJlbG9hZE9uU2VhcmNoIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJOZWNlc2lkYWQiLCJuZ05vdGlmeSIsInZtIiwidGhpcyIsImxvYWQiLCJzdWNjZXNzIiwiZGF0YSIsIm5lY2VzaWRhZGVzIiwiZXJyb3IiLCJlcnIiLCJzZXQiLCIkcm91dGVQYXJhbXMiLCJjYXRlZ29yaWEiLCJjb25zb2xlIiwiZmFjdG9yeSIsIiRodHRwIiwiZGVsZXRlIiwiaWQiLCJ1dGlsIiwicGF0Y2giLCJjcmVhdGUiLCJtZXRob2QiLCJ1cmwiLCJuZWNlc2lkYWRJZCIsInVwZGF0ZSIsIiR3aW5kb3ciLCJDb21lbnRhcmlvIiwiJHNjb3BlIiwibmVjZXNpZGFkIiwic2hvdyIsInNhdmUiLCJjb21lbnRhciIsIkNvbWVudGFyaW9Gb3JtIiwiY3JlYXRlZEF0IiwiRGF0ZSIsImNvbWVudGFyaW9zIiwicHVzaCIsInN1cmUiLCJjb25maXJtIiwibG9jYXRpb24iLCJjb21lbnRhcmlvIiwidXBsb2FkIiwiZmlsZXMiLCJsb2ciLCJmZCIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJzY29wZSIsImNhbGxiYWNrIiwiZ2V0IiwiY2xhdmUiLCJwb3N0Iiwid2l0aENyZWRlbnRpYWxzIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInVuZGVmaW5lZCIsInRyYW5zZm9ybVJlcXVlc3QiLCJpZGVudGl0eSIsInVzZXIiLCJiaW5kVG9Db250cm9sbGVyIiwiTmVjZXNpZGFkRm9ybSIsImxpbmsiLCJlbCIsImF0dHJzIiwibmdNb2RlbEN0cmwiLCJyb3VuZCIsIm51bSIsImQiLCJNYXRoIiwicG93IiwicHJlY2lzaW9uIiwiZm9ybWF0UHJlY2lzaW9uIiwidmFsdWUiLCJwYXJzZUZsb2F0IiwidG9GaXhlZCIsImZvcm1hdFZpZXdWYWx1ZSIsIiRpc0VtcHR5IiwibGFzdFZhbGlkVmFsdWUiLCJtaW4iLCIkcGFyc2VycyIsImlzVW5kZWZpbmVkIiwiaW5kZXhPZiIsIiRzZXRWaWV3VmFsdWUiLCIkcmVuZGVyIiwiZW1wdHkiLCJOVU1CRVJfUkVHRVhQIiwidGVzdCIsIiRzZXRWYWxpZGl0eSIsIiRmb3JtYXR0ZXJzIiwibWluVmFsaWRhdG9yIiwibWF4IiwibWF4VmFsaWRhdG9yIiwiYmluZCIsIiRtb2RlbFZhbHVlIiwiJHZpZXdWYWx1ZSIsInJlcXVpcmUiLCJlbGVtZW50IiwibW9kZWxDdHJsIiwiaW5wdXRWYWx1ZSIsInRyYW5zZm9ybWVkSW5wdXQiLCJyZXBsYWNlIiwiZmlsdGVyIiwibG9jYWxlIiwiY3VycmVuY3lGaWx0ZXIiLCJmb3JtYXRzIiwiTlVNQkVSX0ZPUk1BVFMiLCJhbW91bnQiLCJjdXJyZW5jeVN5bWJvbCIsInNlcCIsIkRFQ0lNQUxfU0VQIiwic3ltYm9sIiwiQ1VSUkVOQ1lfU1lNIiwic3Vic3RyaW5nIiwiJHJvb3RTY29wZSIsIlVzZXIiLCJtZSIsInVzZXJBZ2VudCIsIm5hdmlnYXRvciIsIiRvbiIsImxvYWRpbmciLCJib3R0b21SZWFjaGVkIiwibm90aWNlcyIsImoiLCJpY29uIiwibWVzc2FnZSIsImRlbGV0ZU5vdGljZSIsIm5vdGljZSIsImluZGV4Iiwic3BsaWNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLFlBRUFBLFNBQ0FDLE9BQUEsT0FDQSxVQUNBLG9CQUNBLHNCQUNBLFdBQ0EsV0FDQSxXQUNBLFdBQ0EsZ0JBT0EsK0JBRUFDLEtBQUEsYUFBQSxTQUFBQyxHQUNBQyxPQUFBRCxXQUFBQSxLQUVBRSxRQUFBLGlCQUFBLFNBQUFDLEdBQ0FBLEVBQ0FDLEtBQUEsS0FDQUMsWUFBQSx5QkFDQUMsZ0JBQUEsSUFFQUYsS0FBQSxLQUNBQyxZQUFBLDJCQUNBQyxnQkFBQSxFQUNBQyxXQUFBLFdBQ0FDLGFBQUEsYUFFQUosS0FBQSxrQkFDQUMsWUFBQSxpQ0FDQUUsV0FBQSx1QkFDQUMsYUFBQSxnQkFFQUosS0FBQSx5QkFDQUMsWUFBQSxnQ0FDQUUsV0FBQSx1QkFDQUMsYUFBQSxnQkFFQUosS0FBQSx5QkFDQUMsWUFBQSxtQ0FDQUMsZ0JBQUEsRUFDQUMsV0FBQSxnQkFDQUMsYUFBQSxrQkFFQUosS0FBQSxXQUNBQyxZQUFBLDRCQUNBQyxnQkFBQSxFQUNBQyxXQUFBLGFBQ0FDLGFBQUEsZUFFQUosS0FBQSxnQkFDQUMsWUFBQSw2QkFDQUMsZ0JBQUEsRUFDQUMsV0FBQSxXQUNBQyxhQUFBLGFBRUFKLEtBQUEsYUFDQUMsWUFBQSxpQ0FFQUQsS0FBQSxlQUNBQyxZQUFBLG1DQUVBSSxXQUNBQyxXQUFBLFlDdkVBLFdBQ0EsWUFDQWIsU0FDQUMsT0FBQSxlQUNBUyxXQUFBLFlBQUEsWUFBQSxXQUFBLFNBQUFJLEVBQUFDLEdBRUEsR0FBQUMsR0FBQUMsSUFFQUgsR0FBQUksT0FDQUMsUUFBQSxTQUFBQyxHQUNBSixFQUFBSyxZQUFBRCxJQUVBRSxNQUFBLFNBQUFDLEdB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U0FBQVosR0FDQSxNQUFBRixHQUFBb0MsSUFBQSxjQUFBbEMiLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcsIFtcbiAgICAgICduZ1JvdXRlJyxcbiAgICAgICdtb2JpbGUtYW5ndWxhci11aScsXG4gICAgICAnYW5ndWxhci1sb2FkaW5nLWJhcicsXG4gICAgICAnYXBwLm1haW4nLFxuICAgICAgJ2FwcC5ob21lJyxcbiAgICAgICduZ05vdGlmeScsXG4gICAgICAnYXBwLnVzZXInLFxuICAgICAgJ2FwcC5uZWNlc2lkYWQnLFxuICAgICAgLy8gdG91Y2gvZHJhZyBmZWF0dXJlOiB0aGlzIGlzIGZyb20gJ21vYmlsZS1hbmd1bGFyLXVpLmdlc3R1cmVzLmpzJ1xuICAgICAgLy8gaXQgaXMgYXQgYSB2ZXJ5IGJlZ2lubmluZyBzdGFnZSwgc28gcGxlYXNlIGJlIGNhcmVmdWwgaWYgeW91IGxpa2UgdG8gdXNlXG4gICAgICAvLyBpbiBwcm9kdWN0aW9uLiBUaGlzIGlzIGludGVuZGVkIHRvIHByb3ZpZGUgYSBmbGV4aWJsZSwgaW50ZWdyYXRlZCBhbmQgYW5kXG4gICAgICAvLyBlYXN5IHRvIHVzZSBhbHRlcm5hdGl2ZSB0byBvdGhlciAzcmQgcGFydHkgbGlicyBsaWtlIGhhbW1lci5qcywgd2l0aCB0aGVcbiAgICAgIC8vIGZpbmFsIHBvdXJwb3NlIHRvIGludGVncmF0ZSBnZXN0dXJlcyBpbnRvIGRlZmF1bHQgdWkgaW50ZXJhY3Rpb25zIGxpa2VcbiAgICAgIC8vIG9wZW5pbmcgc2lkZWJhcnMsIHR1cm5pbmcgc3dpdGNoZXMgb24vb2ZmIC4uXG4gICAgICAnbW9iaWxlLWFuZ3VsYXItdWkuZ2VzdHVyZXMnXG4gICAgXSlcbiAgICAucnVuKFsnJHRyYW5zZm9ybScsZnVuY3Rpb24oJHRyYW5zZm9ybSkge1xuICAgICAgd2luZG93LiR0cmFuc2Zvcm0gPSAkdHJhbnNmb3JtO1xuICAgIH1dKVxuICAgIC5jb25maWcoWyckcm91dGVQcm92aWRlcicsZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgICAkcm91dGVQcm92aWRlclxuICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvaG9tZS9ob21lLmh0bWwnLFxuICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgICAud2hlbignLycsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvaG9tZS9zY3JvbGwuaHRtbCcsXG4gICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlLFxuICAgICAgICAgIGNvbnRyb2xsZXI6J0hvbWVDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6J0hvbWVDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAud2hlbignL25lY2VzaWRhZC86aWQnLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL25lY2VzaWRhZC9kZXRhbGxlLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6J05lY2VzaWRhZERldGFsbGVDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6J0RldGFsbGVDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAud2hlbignL25lY2VzaWRhZC86aWQvZWRpdGFyJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy9uZWNlc2lkYWQvZWRpdGFyLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6J05lY2VzaWRhZERldGFsbGVDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6J0RldGFsbGVDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAud2hlbignL2NhdGVnb3JpYS86Y2F0ZWdvcmlhJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy9uZWNlc2lkYWQvY2F0ZWdvcmlhLmh0bWwnLFxuICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZSxcbiAgICAgICAgICBjb250cm9sbGVyOidDYXRlZ29yaWFDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6J0NhdGVnb3JpYUN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvcGVyZmlsJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy91c2Vycy9jb25maWcuaHRtbCcsXG4gICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlLFxuICAgICAgICAgIGNvbnRyb2xsZXI6J0NvbmZpZ0N0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonQ29uZmlnQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLndoZW4oJy91c3VhcmlvLzppZCcsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvdXNlcnMvcHJvZmlsZS5odG1sJyxcbiAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UsXG4gICAgICAgICAgY29udHJvbGxlcjonVXNlckN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonVXNlckN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvY29udGFjdG8nLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL3NoYXJlZC9jb250YWN0by5odG1sJ1xuICAgICAgICB9KVxuICAgICAgICAud2hlbignL3ByaXZhY2lkYWQnLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL3NoYXJlZC9wcml2YWNpZGFkLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC5vdGhlcndpc2Uoe1xuICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICB9KTtcbiAgICB9XSk7XG5cblxuICAgIC8vIGFwcC5kaXJlY3RpdmUoJ3RvdWNoYXJlYScsIFsnJHRvdWNoJywgZnVuY3Rpb24oJHRvdWNoKXtcbiAgICAvLyAgIC8vIFJ1bnMgZHVyaW5nIGNvbXBpbGVcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIHJlc3RyaWN0OiAnQycsXG4gICAgLy8gICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgZWxlbSkge1xuICAgIC8vICAgICAgICRzY29wZS50b3VjaCA9IG51bGw7XG4gICAgLy8gICAgICAgJHRvdWNoLmJpbmQoZWxlbSwge1xuICAgIC8vICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKHRvdWNoKSB7XG4gICAgLy8gICAgICAgICAgICRzY29wZS50b3VjaCA9IHRvdWNoO1xuICAgIC8vICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgLy8gICAgICAgICB9LFxuICAgIC8vXG4gICAgLy8gICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKHRvdWNoKSB7XG4gICAgLy8gICAgICAgICAgICRzY29wZS50b3VjaCA9IHRvdWNoO1xuICAgIC8vICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgLy8gICAgICAgICB9LFxuICAgIC8vXG4gICAgLy8gICAgICAgICBtb3ZlOiBmdW5jdGlvbih0b3VjaCkge1xuICAgIC8vICAgICAgICAgICAkc2NvcGUudG91Y2ggPSB0b3VjaDtcbiAgICAvLyAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgIC8vICAgICAgICAgfSxcbiAgICAvL1xuICAgIC8vICAgICAgICAgZW5kOiBmdW5jdGlvbih0b3VjaCkge1xuICAgIC8vICAgICAgICAgICAkc2NvcGUudG91Y2ggPSB0b3VjaDtcbiAgICAvLyAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICAgIH0pO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9O1xuICAgIC8vIH1dKTtcbiAgICAvL1xuICAgIC8vIC8vXG4gICAgLy8gLy8gYCRkcmFnYCBleGFtcGxlOiBkcmFnIHRvIGRpc21pc3NcbiAgICAvLyAvL1xuICAgIC8vIGFwcC5kaXJlY3RpdmUoJ2RyYWdUb0Rpc21pc3MnLCBmdW5jdGlvbigkZHJhZywgJHBhcnNlLCAkdGltZW91dCl7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICByZXN0cmljdDogJ0EnLFxuICAgIC8vICAgICBjb21waWxlOiBmdW5jdGlvbihlbGVtLCBhdHRycykge1xuICAgIC8vICAgICAgIHZhciBkaXNtaXNzRm4gPSAkcGFyc2UoYXR0cnMuZHJhZ1RvRGlzbWlzcyk7XG4gICAgLy8gICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtKXtcbiAgICAvLyAgICAgICAgIHZhciBkaXNtaXNzID0gZmFsc2U7XG4gICAgLy9cbiAgICAvLyAgICAgICAgICRkcmFnLmJpbmQoZWxlbSwge1xuICAgIC8vICAgICAgICAgICB0cmFuc2Zvcm06ICRkcmFnLlRSQU5TTEFURV9SSUdIVCxcbiAgICAvLyAgICAgICAgICAgbW92ZTogZnVuY3Rpb24oZHJhZykge1xuICAgIC8vICAgICAgICAgICAgIGlmKCBkcmFnLmRpc3RhbmNlWCA+PSBkcmFnLnJlY3Qud2lkdGggLyA0KSB7XG4gICAgLy8gICAgICAgICAgICAgICBkaXNtaXNzID0gdHJ1ZTtcbiAgICAvLyAgICAgICAgICAgICAgIGVsZW0uYWRkQ2xhc3MoJ2Rpc21pc3MnKTtcbiAgICAvLyAgICAgICAgICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgICAgICAgZGlzbWlzcyA9IGZhbHNlO1xuICAgIC8vICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVDbGFzcygnZGlzbWlzcycpO1xuICAgIC8vICAgICAgICAgICAgIH1cbiAgICAvLyAgICAgICAgICAgfSxcbiAgICAvLyAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQ2xhc3MoJ2Rpc21pc3MnKTtcbiAgICAvLyAgICAgICAgICAgfSxcbiAgICAvLyAgICAgICAgICAgZW5kOiBmdW5jdGlvbihkcmFnKSB7XG4gICAgLy8gICAgICAgICAgICAgaWYgKGRpc21pc3MpIHtcbiAgICAvLyAgICAgICAgICAgICAgIGVsZW0uYWRkQ2xhc3MoJ2Rpc21pdHRlZCcpO1xuICAgIC8vICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgICAgICAgICAgICAgICBkaXNtaXNzRm4oc2NvcGUpO1xuICAgIC8vICAgICAgICAgICAgICAgICB9KTtcbiAgICAvLyAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgLy8gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgICAgICAgIGRyYWcucmVzZXQoKTtcbiAgICAvLyAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICAgIH1cbiAgICAvLyAgICAgICAgIH0pO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG4gICAgLy9cbiAgICAvLyAvL1xuICAgIC8vIC8vIEFub3RoZXIgYCRkcmFnYCB1c2FnZSBleGFtcGxlOiB0aGlzIGlzIGhvdyB5b3UgY291bGQgY3JlYXRlXG4gICAgLy8gLy8gYSB0b3VjaCBlbmFibGVkIFwiZGVjayBvZiBjYXJkc1wiIGNhcm91c2VsLiBTZWUgYGNhcm91c2VsLmh0bWxgIGZvciBtYXJrdXAuXG4gICAgLy8gLy9cbiAgICAvLyBhcHAuZGlyZWN0aXZlKCdjYXJvdXNlbCcsIGZ1bmN0aW9uKCl7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICByZXN0cmljdDogJ0MnLFxuICAgIC8vICAgICBzY29wZToge30sXG4gICAgLy8gICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAgIHRoaXMuaXRlbUNvdW50ID0gMDtcbiAgICAvLyAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBudWxsO1xuICAgIC8vXG4gICAgLy8gICAgICAgdGhpcy5hZGRJdGVtID0gZnVuY3Rpb24oKXtcbiAgICAvLyAgICAgICAgIHZhciBuZXdJZCA9IHRoaXMuaXRlbUNvdW50Kys7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLml0ZW1Db3VudCA9PT0gMSA/IG5ld0lkIDogdGhpcy5hY3RpdmVJdGVtO1xuICAgIC8vICAgICAgICAgcmV0dXJuIG5ld0lkO1xuICAgIC8vICAgICAgIH07XG4gICAgLy9cbiAgICAvLyAgICAgICB0aGlzLm5leHQgPSBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgdGhpcy5hY3RpdmVJdGVtID0gdGhpcy5hY3RpdmVJdGVtIHx8IDA7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLmFjdGl2ZUl0ZW0gPT09IHRoaXMuaXRlbUNvdW50IC0gMSA/IDAgOiB0aGlzLmFjdGl2ZUl0ZW0gKyAxO1xuICAgIC8vICAgICAgIH07XG4gICAgLy9cbiAgICAvLyAgICAgICB0aGlzLnByZXYgPSBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgdGhpcy5hY3RpdmVJdGVtID0gdGhpcy5hY3RpdmVJdGVtIHx8IDA7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLmFjdGl2ZUl0ZW0gPT09IDAgPyB0aGlzLml0ZW1Db3VudCAtIDEgOiB0aGlzLmFjdGl2ZUl0ZW0gLSAxO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG5cblxuXG4gICAgLy9cbiAgICAvLyBGb3IgdGhpcyB0cml2aWFsIGRlbW8gd2UgaGF2ZSBqdXN0IGEgdW5pcXVlIE1haW5Db250cm9sbGVyXG4gICAgLy8gZm9yIGV2ZXJ5dGhpbmdcbiAgICAvL1xuICAgIC8vIGFwcC5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSl7XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5zd2lwZWQgPSBmdW5jdGlvbihkaXJlY3Rpb24pIHtcbiAgICAvLyAgICAgYWxlcnQoJ1N3aXBlZCAnICsgZGlyZWN0aW9uKTtcbiAgICAvLyAgIH07XG4gICAgLy9cbiAgICAvLyAgIC8vIFVzZXIgYWdlbnQgZGlzcGxheWVkIGluIGhvbWUgcGFnZVxuICAgIC8vICAgJHNjb3BlLnVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgLy9cbiAgICAvLyAgIC8vIE5lZWRlZCBmb3IgdGhlIGxvYWRpbmcgc2NyZWVuXG4gICAgLy8gICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbigpe1xuICAgIC8vICAgICAkcm9vdFNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgIC8vICAgfSk7XG4gICAgLy9cbiAgICAvLyAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKXtcbiAgICAvLyAgICAgJHJvb3RTY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgLy8gICB9KTtcbiAgICAvL1xuICAgIC8vICAgLy8gRmFrZSB0ZXh0IGkgdXNlZCBoZXJlIGFuZCB0aGVyZS5cbiAgICAvLyAgICRzY29wZS5sb3JlbSA9ICdMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzaWNpbmcgZWxpdC4gVmVsIGV4cGxpY2FibywgYWxpcXVpZCBlYXF1ZSBzb2x1dGEgbmloaWwgZWxpZ2VuZGkgYWRpcGlzY2kgZXJyb3IsIGlsbHVtIGNvcnJ1cHRpIG5hbSBmdWdhIG9tbmlzIHF1b2QgcXVhZXJhdCBtb2xsaXRpYSBleHBlZGl0YSBpbXBlZGl0IGRvbG9yZXMgaXBzYW0uIE9iY2FlY2F0aS4nO1xuICAgIC8vXG4gICAgLy8gICAvL1xuICAgIC8vICAgLy8gJ1Njcm9sbCcgc2NyZWVuXG4gICAgLy8gICAvL1xuICAgIC8vICAgdmFyIHNjcm9sbEl0ZW1zID0gW107XG4gICAgLy9cbiAgICAvLyAgIGZvciAodmFyIGk9MTsgaTw9MTAwOyBpKyspIHtcbiAgICAvLyAgICAgc2Nyb2xsSXRlbXMucHVzaCgnSXRlbSAnICsgaSk7XG4gICAgLy8gICB9XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5zY3JvbGxJdGVtcyA9IHNjcm9sbEl0ZW1zO1xuICAgIC8vXG4gICAgLy8gICAkc2NvcGUuYm90dG9tUmVhY2hlZCA9IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAvKiBnbG9iYWwgYWxlcnQ6IGZhbHNlOyAqL1xuICAgIC8vICAgICBhbGVydCgnQ29uZ3JhdHMgeW91IHNjcm9sbGVkIHRvIHRoZSBlbmQgb2YgdGhlIGxpc3QhJyk7XG4gICAgLy8gICB9O1xuICAgIC8vXG4gICAgLy8gICAvL1xuICAgIC8vICAgLy8gUmlnaHQgU2lkZWJhclxuICAgIC8vICAgLy9cbiAgICAvLyAgICRzY29wZS5jaGF0VXNlcnMgPSBbXG4gICAgLy8gICAgIHsgbmFtZTogJ0NhcmxvcyAgRmxvd2VycycsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdCeXJvbiBUYXlsb3InLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmFuYSAgVGVycnknLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnRGFycnlsICBTdG9uZScsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdGYW5uaWUgIENhcmxzb24nLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSG9sbHkgTmd1eWVuJywgb25saW5lOiB0cnVlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0JpbGwgIENoYXZleicsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdWZXJvbmljYSAgTWF4d2VsbCcsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdKZXNzaWNhIFdlYnN0ZXInLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmFja2llICBCYXJ0b24nLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnQ3J5c3RhbCBEcmFrZScsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnTWlsdG9uICBEZWFuJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdKb2FubiBKb2huc3RvbicsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnQ29yYSAgVmF1Z2huJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdOaW5hICBCcmlnZ3MnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0Nhc2V5IFR1cm5lcicsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmltbWllICBXaWxzb24nLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ05hdGhhbmllbCBTdGVlbGUnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0F1YnJleSAgQ29sZScsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnRG9ubmllICBTdW1tZXJzJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdLYXRlICBNeWVycycsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnUHJpc2NpbGxhIEhhd2tpbnMnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0pvZSBCYXJrZXInLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0xlZSBOb3JtYW4nLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0Vib255IFJpY2UnLCBvbmxpbmU6IGZhbHNlIH1cbiAgICAvLyAgIF07XG4gICAgLy9cbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyAnRm9ybXMnIHNjcmVlblxuICAgIC8vICAgLy9cbiAgICAvLyAgICRzY29wZS5yZW1lbWJlck1lID0gdHJ1ZTtcbiAgICAvLyAgICRzY29wZS5lbWFpbCA9ICdtZUBleGFtcGxlLmNvbSc7XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICBhbGVydCgnWW91IHN1Ym1pdHRlZCB0aGUgbG9naW4gZm9ybScpO1xuICAgIC8vICAgfTtcbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyAnRHJhZycgc2NyZWVuXG4gICAgLy8gICAvL1xuICAgIC8vICAgJHNjb3BlLm5vdGljZXMgPSBbXTtcbiAgICAvL1xuICAgIC8vICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgLy8gICAgICRzY29wZS5ub3RpY2VzLnB1c2goe2ljb246ICdlbnZlbG9wZScsIG1lc3NhZ2U6ICdOb3RpY2UgJyArIChqICsgMSkgfSk7XG4gICAgLy8gICB9XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5kZWxldGVOb3RpY2UgPSBmdW5jdGlvbihub3RpY2UpIHtcbiAgICAvLyAgICAgdmFyIGluZGV4ID0gJHNjb3BlLm5vdGljZXMuaW5kZXhPZihub3RpY2UpO1xuICAgIC8vICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgIC8vICAgICAgICRzY29wZS5ub3RpY2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAuaG9tZScsW10pXG4gICAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLFsnTmVjZXNpZGFkJywnbmdOb3RpZnknLGZ1bmN0aW9uIChOZWNlc2lkYWQsbmdOb3RpZnkpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIE5lY2VzaWRhZC5sb2FkKClcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICB2bS5uZWNlc2lkYWRlcyA9IGRhdGE7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwgJ2Vycm9yJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAubmVjZXNpZGFkLmNhdGVnb3JpYScsW10pXG4gICAgICAuY29udHJvbGxlcignQ2F0ZWdvcmlhQ3RybCcsWydOZWNlc2lkYWQnLCckcm91dGVQYXJhbXMnLGZ1bmN0aW9uIChOZWNlc2lkYWQsJHJvdXRlUGFyYW1zKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuXG5cbiAgICAgICAgTmVjZXNpZGFkLmNhdGVnb3JpYSgkcm91dGVQYXJhbXMuY2F0ZWdvcmlhKVxuICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2bS5uZWNlc2lkYWRlcyA9IGRhdGEubmVjZXNpZGFkZXM7XG4gICAgICAgICAgICB2bS5jYXRlZ29yaWEgPSBkYXRhLmNhdGVnb3JpYTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAuY29tZW50YXJpby5zZXJ2aWNlJyxbXSlcbiAgICAgIC5mYWN0b3J5KCdDb21lbnRhcmlvJyxbJyRodHRwJyxmdW5jdGlvbiAoJGh0dHApIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRlbGV0ZTpmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvY29tZW50YXJpb3MvJyArIGlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHV0aWw6ZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucGF0Y2goJy9hcGkvY29tZW50YXJpb3MvJyArIGlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZTpmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgZGF0YSAgICA6ICBkYXRhLFxuICAgICAgICAgICAgICBtZXRob2QgIDogJ1BPU1QnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvbmVjZXNpZGFkZXMvJyArIGRhdGEubmVjZXNpZGFkSWQgKyAnL2NvbWVudGFyaW9zJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cGRhdGU6ZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgIGRhdGEgICAgOiAgZGF0YSxcbiAgICAgICAgICAgICAgbWV0aG9kICA6ICdQVVQnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvY29tZW50YXJpb3MvJyArIGRhdGEuaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9XSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAubmVjZXNpZGFkLmRldGFsbGUnLFtdKVxuICAgICAgLmNvbnRyb2xsZXIoJ05lY2VzaWRhZERldGFsbGVDdHJsJyxbJ05lY2VzaWRhZCcsJ25nTm90aWZ5JywnJHJvdXRlUGFyYW1zJywnJHdpbmRvdycsJ0NvbWVudGFyaW8nLCckc2NvcGUnLGZ1bmN0aW9uIChOZWNlc2lkYWQsbmdOb3RpZnksJHJvdXRlUGFyYW1zLCR3aW5kb3csQ29tZW50YXJpbywkc2NvcGUpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5uZWNlc2lkYWQgPSB7fTtcbiAgICAgICAgdm0uQ29tZW50YXJpbyA9IHt9O1xuXG4gICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICBOZWNlc2lkYWQuc2hvdygkcm91dGVQYXJhbXMuaWQpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICB2bS5uZWNlc2lkYWQgPSBkYXRhO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgTmVjZXNpZGFkLnVwZGF0ZSh2bS5uZWNlc2lkYWQpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZGF0YSwnc3VjY2VzcycpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jb21lbnRhciA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIHZtLkNvbWVudGFyaW9Gb3JtLm5lY2VzaWRhZElkID0gdm0ubmVjZXNpZGFkLmlkO1xuXG4gICAgICAgICAgQ29tZW50YXJpby5jcmVhdGUodm0uQ29tZW50YXJpb0Zvcm0pXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZGF0YSwnc3VjY2VzcycpO1xuICAgICAgICAgICAgICB2bS5Db21lbnRhcmlvLmNyZWF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgIHZtLm5lY2VzaWRhZC5jb21lbnRhcmlvcy5wdXNoKHZtLkNvbWVudGFyaW8pO1xuICAgICAgICAgICAgICB2bS5Db21lbnRhcmlvID0ge307ICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZXJyLCdlcnJvcicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBzdXJlID0gY29uZmlybSgnUmVhbG1lbnRlIGRlc2VhcyBlbGltaW5hciBlc3RhIHB1YmxpY2FjacOzbj8nKTtcbiAgICAgICAgICBpZiAoc3VyZSkge1xuICAgICAgICAgICAgTmVjZXNpZGFkLmRlbGV0ZSh2bS5uZWNlc2lkYWQuaWQpXG4gICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGRhdGEsJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uID0gJyMvJztcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZXJyLCdlcnJvcicpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXRpbCA9IGZ1bmN0aW9uIChjb21lbnRhcmlvKSB7XG5cbiAgICAgICAgICBDb21lbnRhcmlvLnV0aWwoY29tZW50YXJpby5pZClcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgIGNvbWVudGFyaW8udXRpbCA9IHRydWU7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChkYXRhLCdzdWNjZXNzJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwnZXJyb3InKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS51cGxvYWQgPSBmdW5jdGlvbihmaWxlcykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTdWJpZW5kbyBhcmNoaXZvJyk7XG4gICAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgLy9UYWtlIHRoZSBmaXJzdCBzZWxlY3RlZCBmaWxlXG5cbiAgICAgICAgICBpZiAoZmlsZXNbMF0pIHtcbiAgICAgICAgICAgIGZkLmFwcGVuZChcImZpbGVcIiwgZmlsZXNbMF0pO1xuXG4gICAgICAgICAgICBOZWNlc2lkYWQudXBsb2FkKGZkLCRyb3V0ZVBhcmFtcy5pZClcbiAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZGF0YSwnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwnZXJyb3InKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgfTtcblxuXG4gICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwLm5lY2VzaWRhZC5pdGVtJyxbXSlcbiAgICAgIC5kaXJlY3RpdmUoJ25lY2VzaWRhZEl0ZW0nLGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvbmVjZXNpZGFkL2l0ZW0uaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICBuZWNlc2lkYWQ6ICc9J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwLm5lY2VzaWRhZCcsW1xuICAgICAgJ2FwcC5uZWNlc2lkYWQuc2VydmljZScsXG4gICAgICAnYXBwLm5lY2VzaWRhZC5udWV2YScsXG4gICAgICAnYXBwLm5lY2VzaWRhZC5pdGVtJyxcbiAgICAgICdhcHAubmVjZXNpZGFkLmRldGFsbGUnLFxuICAgICAgJ2FwcC5uZWNlc2lkYWQuY2F0ZWdvcmlhJyxcbiAgICAgICdhcHAuY29tZW50YXJpby5zZXJ2aWNlJ1xuICAgIF0pXG4gICAgICAuY29udHJvbGxlcignTmVjZXNpZGFkZXNDdHJsJyxbJ05lY2VzaWRhZCcsJ25nTm90aWZ5JyxmdW5jdGlvbiAoTmVjZXNpZGFkLG5nTm90aWZ5KSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICBOZWNlc2lkYWQubG9hZCgpXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgdm0ubmVjZXNpZGFkZXMgPSBkYXRhO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsICdlcnJvcicpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwLm5lY2VzaWRhZC5zZXJ2aWNlJyxbXSlcbiAgICAgIC5mYWN0b3J5KCdOZWNlc2lkYWQnLFsnJGh0dHAnLGZ1bmN0aW9uICgkaHR0cCkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbG9hZDpmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvbmVjZXNpZGFkZXMnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNob3c6ZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL25lY2VzaWRhZGVzLycgKyBpZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYXRlZ29yaWE6ZnVuY3Rpb24gKGNsYXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2NhdGVnb3JpYXMvJyArIGNsYXZlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlbGV0ZTpmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvbmVjZXNpZGFkZXMvJyArIGlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZTpmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgZGF0YSAgICA6ICBkYXRhLFxuICAgICAgICAgICAgICBtZXRob2QgIDogJ1BPU1QnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvbmVjZXNpZGFkZXMnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVwbG9hZDpmdW5jdGlvbiAoZmQsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL25lY2VzaWRhZGVzLycgKyBpZCArICcvdXBsb2FkJywgZmQsIHtcbiAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlLFxuICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6IHVuZGVmaW5lZCB9LFxuICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVwZGF0ZTpmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgZGF0YSAgICA6ICBkYXRhLFxuICAgICAgICAgICAgICBtZXRob2QgIDogJ1BVVCcsXG4gICAgICAgICAgICAgIHVybCAgICAgOiAnL2FwaS9uZWNlc2lkYWRlcy8nICsgZGF0YS5pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH1dKVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcC5uZWNlc2lkYWQubnVldmEnLFtdKVxuICAgICAgLmRpcmVjdGl2ZSgnbnVldmFOZWNlc2lkYWQnLFsnTmVjZXNpZGFkJywnbmdOb3RpZnknLCckd2luZG93JyxmdW5jdGlvbiAoTmVjZXNpZGFkLG5nTm90aWZ5LCR3aW5kb3cpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvbmVjZXNpZGFkL251ZXZhLmh0bWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgdXNlcjogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiBcIk51ZXZhTmVjZXNpZGFkQ3RybFwiLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOdWV2YU5lY2VzaWRhZEN0cmwnXG4gICAgICAgICAgfTtcbiAgICAgIH1dKVxuICAgICAgLmNvbnRyb2xsZXIoJ051ZXZhTmVjZXNpZGFkQ3RybCcsWydOZWNlc2lkYWQnLCduZ05vdGlmeScsJyR3aW5kb3cnLGZ1bmN0aW9uIChOZWNlc2lkYWQsbmdOb3RpZnksJHdpbmRvd1xuICAgICAgKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uTmVjZXNpZGFkRm9ybSA9IHt9O1xuXG4gICAgICAgIHZtLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBOZWNlc2lkYWQuY3JlYXRlKHZtLk5lY2VzaWRhZEZvcm0pXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoJ05lY2VzaWRhZCBhZ3JlZ2FkYSBjb3JyZWN0YW1lbnRlIDopJywnc3VjY2VzcycpOyAkd2luZG93LmxvY2F0aW9uID0gJyMvbmVjZXNpZGFkLycgKyBkYXRhICsgJy9lZGl0YXInO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgfV0pO1xufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycsIFtdKVxuICAuZGlyZWN0aXZlKCdtb25leScsIGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBOVU1CRVJfUkVHRVhQID0gL15cXHMqKFxcLXxcXCspPyhcXGQrfChcXGQqKFxcLlxcZCopKSlcXHMqJC87XG5cbiAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbCwgYXR0cnMsIG5nTW9kZWxDdHJsKSB7XG4gICAgICB2YXIgbWluID0gcGFyc2VGbG9hdChhdHRycy5taW4gfHwgMCk7XG4gICAgICB2YXIgcHJlY2lzaW9uID0gcGFyc2VGbG9hdChhdHRycy5wcmVjaXNpb24gfHwgMik7XG4gICAgICB2YXIgbGFzdFZhbGlkVmFsdWU7XG5cbiAgICAgIGZ1bmN0aW9uIHJvdW5kKG51bSkge1xuICAgICAgICB2YXIgZCA9IE1hdGgucG93KDEwLCBwcmVjaXNpb24pO1xuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChudW0gKiBkKSAvIGQ7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGZvcm1hdFByZWNpc2lvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZChwcmVjaXNpb24pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBmb3JtYXRWaWV3VmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5nTW9kZWxDdHJsLiRpc0VtcHR5KHZhbHVlKSA/ICcnIDogJycgKyB2YWx1ZTtcbiAgICAgIH1cblxuXG4gICAgICBuZ01vZGVsQ3RybC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgICB2YWx1ZSA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIGxlYWRpbmcgZGVjaW1hbCBwb2ludCwgbGlrZSBcIi41XCJcbiAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJy4nKSA9PT0gMCkge1xuICAgICAgICAgIHZhbHVlID0gJzAnICsgdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbGxvdyBcIi1cIiBpbnB1dHMgb25seSB3aGVuIG1pbiA8IDBcbiAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJy0nKSA9PT0gMCkge1xuICAgICAgICAgIGlmIChtaW4gPj0gMCkge1xuICAgICAgICAgICAgdmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZpZXdWYWx1ZSgnJyk7XG4gICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJy0nKSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICcnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBlbXB0eSA9IG5nTW9kZWxDdHJsLiRpc0VtcHR5KHZhbHVlKTtcbiAgICAgICAgaWYgKGVtcHR5IHx8IE5VTUJFUl9SRUdFWFAudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICBsYXN0VmFsaWRWYWx1ZSA9ICh2YWx1ZSA9PT0gJycpXG4gICAgICAgICAgPyBudWxsXG4gICAgICAgICAgOiAoZW1wdHkgPyB2YWx1ZSA6IHBhcnNlRmxvYXQodmFsdWUpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBSZW5kZXIgdGhlIGxhc3QgdmFsaWQgaW5wdXQgaW4gdGhlIGZpZWxkXG4gICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZpZXdWYWx1ZShmb3JtYXRWaWV3VmFsdWUobGFzdFZhbGlkVmFsdWUpKTtcbiAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBuZ01vZGVsQ3RybC4kc2V0VmFsaWRpdHkoJ251bWJlcicsIHRydWUpO1xuICAgICAgICByZXR1cm4gbGFzdFZhbGlkVmFsdWU7XG4gICAgICB9KTtcbiAgICAgIG5nTW9kZWxDdHJsLiRmb3JtYXR0ZXJzLnB1c2goZm9ybWF0Vmlld1ZhbHVlKTtcblxuICAgICAgdmFyIG1pblZhbGlkYXRvciA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIGlmICghbmdNb2RlbEN0cmwuJGlzRW1wdHkodmFsdWUpICYmIHZhbHVlIDwgbWluKSB7XG4gICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZhbGlkaXR5KCdtaW4nLCBmYWxzZSk7XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0VmFsaWRpdHkoJ21pbicsIHRydWUpO1xuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIG5nTW9kZWxDdHJsLiRwYXJzZXJzLnB1c2gobWluVmFsaWRhdG9yKTtcbiAgICAgIG5nTW9kZWxDdHJsLiRmb3JtYXR0ZXJzLnB1c2gobWluVmFsaWRhdG9yKTtcblxuICAgICAgaWYgKGF0dHJzLm1heCkge1xuICAgICAgICB2YXIgbWF4ID0gcGFyc2VGbG9hdChhdHRycy5tYXgpO1xuICAgICAgICB2YXIgbWF4VmFsaWRhdG9yID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIW5nTW9kZWxDdHJsLiRpc0VtcHR5KHZhbHVlKSAmJiB2YWx1ZSA+IG1heCkge1xuICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZhbGlkaXR5KCdtYXgnLCBmYWxzZSk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0VmFsaWRpdHkoJ21heCcsIHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBuZ01vZGVsQ3RybC4kcGFyc2Vycy5wdXNoKG1heFZhbGlkYXRvcik7XG4gICAgICAgIG5nTW9kZWxDdHJsLiRmb3JtYXR0ZXJzLnB1c2gobWF4VmFsaWRhdG9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gUm91bmQgb2ZmXG4gICAgICBpZiAocHJlY2lzaW9uID4gLTEpIHtcbiAgICAgICAgbmdNb2RlbEN0cmwuJHBhcnNlcnMucHVzaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWUgPyByb3VuZCh2YWx1ZSkgOiB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIG5nTW9kZWxDdHJsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlID8gZm9ybWF0UHJlY2lzaW9uKHZhbHVlKSA6IHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZWwuYmluZCgnYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gbmdNb2RlbEN0cmwuJG1vZGVsVmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIG5nTW9kZWxDdHJsLiR2aWV3VmFsdWUgPSBmb3JtYXRQcmVjaXNpb24odmFsdWUpO1xuICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICBsaW5rOiBsaW5rXG4gICAgfTtcbiAgfSkuZGlyZWN0aXZlKCdudW1iZXJzT25seScsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG1vZGVsQ3RybCkge1xuICAgICAgICBtb2RlbEN0cmwuJHBhcnNlcnMucHVzaChmdW5jdGlvbiAoaW5wdXRWYWx1ZSkge1xuICAgICAgICAgIC8vIHRoaXMgbmV4dCBpZiBpcyBuZWNlc3NhcnkgZm9yIHdoZW4gdXNpbmcgbmctcmVxdWlyZWQgb24geW91ciBpbnB1dC5cbiAgICAgICAgICAvLyBJbiBzdWNoIGNhc2VzLCB3aGVuIGEgbGV0dGVyIGlzIHR5cGVkIGZpcnN0LCB0aGlzIHBhcnNlciB3aWxsIGJlIGNhbGxlZFxuICAgICAgICAgIC8vIGFnYWluLCBhbmQgdGhlIDJuZCB0aW1lLCB0aGUgdmFsdWUgd2lsbCBiZSB1bmRlZmluZWRcbiAgICAgICAgICBpZiAoaW5wdXRWYWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJyc7XG4gICAgICAgICAgdmFyIHRyYW5zZm9ybWVkSW5wdXQgPSBpbnB1dFZhbHVlLnJlcGxhY2UoL1teMC05Ky5dL2csICcnKTtcbiAgICAgICAgICBpZiAodHJhbnNmb3JtZWRJbnB1dCE9PWlucHV0VmFsdWUpIHtcbiAgICAgICAgICAgIG1vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKHRyYW5zZm9ybWVkSW5wdXQpO1xuICAgICAgICAgICAgbW9kZWxDdHJsLiRyZW5kZXIoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWRJbnB1dDtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcnMnLFtdKVxuICAuZmlsdGVyKCdkaW5lcm8nLFxuICBbICckZmlsdGVyJywgJyRsb2NhbGUnLCBmdW5jdGlvbihmaWx0ZXIsIGxvY2FsZSkge1xuICAgIHZhciBjdXJyZW5jeUZpbHRlciA9IGZpbHRlcignY3VycmVuY3knKTtcbiAgICB2YXIgZm9ybWF0cyA9IGxvY2FsZS5OVU1CRVJfRk9STUFUUztcbiAgICByZXR1cm4gZnVuY3Rpb24oYW1vdW50LCBudW0sIGN1cnJlbmN5U3ltYm9sKSB7XG4gICAgICBpZiAobnVtPT09MCkgbnVtID0gLTE7XG4gICAgICB2YXIgdmFsdWUgPSBjdXJyZW5jeUZpbHRlcihhbW91bnQsIGN1cnJlbmN5U3ltYm9sKTtcbiAgICAgIHZhciBzZXAgPSB2YWx1ZS5pbmRleE9mKGZvcm1hdHMuREVDSU1BTF9TRVApKzE7XG4gICAgICB2YXIgc3ltYm9sID0gJyc7XG4gICAgICBpZiAoc2VwPHZhbHVlLmluZGV4T2YoZm9ybWF0cy5DVVJSRU5DWV9TWU0pKSBzeW1ib2wgPSAnICcrZm9ybWF0cy5DVVJSRU5DWV9TWU07XG4gICAgICByZXR1cm4gdmFsdWUuc3Vic3RyaW5nKDAsIHNlcCtudW0pK3N5bWJvbDtcbiAgICB9O1xuICB9IF0pO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcC5tYWluJywgW1xuICAgICAgJ2FwcC5kaXJlY3RpdmVzJyxcbiAgICAgICdhcHAuZmlsdGVycydcbiAgICBdKVxuICAgIC5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsWyckcm9vdFNjb3BlJywnJHNjb3BlJywnVXNlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgVXNlcil7XG5cbiAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgIFVzZXIubWUoKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHZtLnVzZXIgPSBkYXRhO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBVc2VyIGFnZW50IGRpc3BsYXllZCBpbiBob21lIHBhZ2VcbiAgICAgICRzY29wZS51c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuXG4gICAgICAvLyBOZWVkZWQgZm9yIHRoZSBsb2FkaW5nIHNjcmVlblxuICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oKXtcbiAgICAgICAgJHJvb3RTY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICRyb290U2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSk7XG5cblxuXG4gICAgICAkc2NvcGUuYm90dG9tUmVhY2hlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKiBnbG9iYWwgYWxlcnQ6IGZhbHNlOyAqL1xuICAgICAgICAvLyBhbGVydCgnQ29uZ3JhdHMgeW91IHNjcm9sbGVkIHRvIHRoZSBlbmQgb2YgdGhlIGxpc3QhJyk7XG4gICAgICB9O1xuXG5cbiAgICAgIC8vXG4gICAgICAvLyAnRHJhZycgc2NyZWVuXG4gICAgICAvL1xuICAgICAgJHNjb3BlLm5vdGljZXMgPSBbXTtcblxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgICRzY29wZS5ub3RpY2VzLnB1c2goe2ljb246ICdlbnZlbG9wZScsIG1lc3NhZ2U6ICdOb3RpY2UgJyArIChqICsgMSkgfSk7XG4gICAgICB9XG5cbiAgICAgICRzY29wZS5kZWxldGVOb3RpY2UgPSBmdW5jdGlvbihub3RpY2UpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gJHNjb3BlLm5vdGljZXMuaW5kZXhPZihub3RpY2UpO1xuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICRzY29wZS5ub3RpY2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VyLmNvbmZpZycsIFtdKVxuICAgIC5jb250cm9sbGVyKCdDb25maWdDdHJsJyxbJ25nTm90aWZ5JywnVXNlcicsZnVuY3Rpb24obmdOb3RpZnksVXNlcil7XG5cbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS51c2VyID0ge307XG4gICAgICBjb25zb2xlLmxvZygnQ2FyZ2FuZG8nKTtcblxuICAgICAgVXNlci5tZSgpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uICAoZGF0YSkge1xuICAgICAgICAgIHZtLnVzZXIgPSBkYXRhO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24gIChlcnIpIHtcbiAgICAgICAgICBuZ05vdGlmeS5zZXQoZXJyLCdlcnJvcicpO1xuICAgICAgICB9KTtcblxuICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uICAoKSB7XG4gICAgICAgIFVzZXIudXBkYXRlKHZtLnVzZXIpXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIG5nTm90aWZ5LnNldChkYXRhLCdzdWNjZXNzJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gIChlcnIpIHtcbiAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH1dKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VyJywgW1xuICAgICdhcHAudXNlci5zZXJ2aWNlJyxcbiAgICAnYXBwLnVzZXIuY29uZmlnJyAvLyBlZGl0YXIgcGVyZmlsIGRlbCB1c3VhcmlvIHkgc3UgY29uZmlndXJhY2nDs25cbiAgXSlcbiAgICAuY29udHJvbGxlcignVXNlckN0cmwnLFsnbmdOb3RpZnknLCdVc2VyJywnJHJvdXRlUGFyYW1zJyxmdW5jdGlvbihuZ05vdGlmeSxVc2VyLCRyb3V0ZVBhcmFtcyl7XG5cbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICBjb25zb2xlLmxvZygnQ2FyZ2FuZG8nKTtcblxuICAgICAgVXNlci5zaG93KCRyb3V0ZVBhcmFtcy5pZClcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gIChkYXRhKSB7XG4gICAgICAgICAgICB2bS51c2VyID0gZGF0YTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubycpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5lcnJvcihmdW5jdGlvbiAgKGVycikge1xuICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgIH0pO1xuXG4gICAgfV0pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwLnVzZXIuc2VydmljZScsICBbXSlcblxuICAgICAgLmZhY3RvcnkgKCdVc2VyJywgWyckaHR0cCcsZnVuY3Rpb24gKCRodHRwKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtZTpmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzL3Byb2ZpbGUnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVwZGF0ZTpmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICAgICAgICBkYXRhOmRhdGEsXG4gICAgICAgICAgICAgIHVybDonL2FwaS91c2Vycy9wcm9maWxlJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzaG93OmZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy8nICsgaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1dKTtcblxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
