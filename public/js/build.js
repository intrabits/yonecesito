!function(){"use strict";angular.module("app",["ngRoute","mobile-angular-ui","app.main","app.home","ngNotify","app.user","app.necesidad","mobile-angular-ui.gestures"]).run(["$transform",function(e){window.$transform=e}]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"scripts/home/home.html",reloadOnSearch:!1}).when("/",{templateUrl:"scripts/home/scroll.html",reloadOnSearch:!1,controller:"HomeCtrl",controllerAs:"HomeCtrl"}).when("/necesidad/:id",{templateUrl:"scripts/necesidad/detalle.html",controller:"NecesidadDetalleCtrl",controllerAs:"DetalleCtrl"}).when("/necesidad/:id/editar",{templateUrl:"scripts/necesidad/editar.html",controller:"NecesidadDetalleCtrl",controllerAs:"DetalleCtrl"}).when("/categoria/:categoria",{templateUrl:"scripts/necesidad/categoria.html",reloadOnSearch:!1,controller:"CategoriaCtrl",controllerAs:"CategoriaCtrl"}).when("/perfil",{templateUrl:"scripts/users/config.html",reloadOnSearch:!1,controller:"ConfigCtrl",controllerAs:"ConfigCtrl"}).when("/usuario/:id",{templateUrl:"scripts/users/profile.html",reloadOnSearch:!1,controller:"UserCtrl",controllerAs:"UserCtrl"}).when("/contacto",{templateUrl:"scripts/shared/contacto.html"}).when("/privacidad",{templateUrl:"scripts/shared/privacidad.html"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("app.home",[]).controller("HomeCtrl",["Necesidad","ngNotify",function(e,r){var t=this;e.load().success(function(e){t.necesidades=e}).error(function(e){r.set(e,"error")})}])}(),function(){"use strict";angular.module("app.necesidad.categoria",[]).controller("CategoriaCtrl",["Necesidad","$routeParams",function(e,r){var t=this;e.categoria(r.categoria).success(function(e){t.necesidades=e.necesidades,t.categoria=e.categoria}).error(function(e){console.error(e)})}])}(),function(){"use strict";angular.module("app.comentario.service",[]).factory("Comentario",["$http",function(e){return{"delete":function(r){return e["delete"]("/api/comentarios/"+r)},create:function(r){return e({data:r,method:"POST",url:"/api/necesidades/"+r.necesidadId+"/comentarios"})},update:function(r){return e({data:r,method:"PUT",url:"/api/comentarios/"+r.id})}}}])}(),function(){"use strict";angular.module("app.necesidad.detalle",[]).controller("NecesidadDetalleCtrl",["Necesidad","ngNotify","$routeParams","$window","Comentario",function(e,r,t,n,o){var i=this;i.necesidad={},i.ComentarioForm={},t.id&&e.show(t.id).success(function(e){i.necesidad=e}).error(function(e){r.set(e,"error")}),i.save=function(){e.update(i.necesidad).success(function(e){r.set(e,"success")}).error(function(e){r.set(e,"error")})},i.comentar=function(){i.ComentarioForm.necesidadId=i.necesidad.id,i.ComentarioForm.userId=i.necesidad.userId,i.Comentario.createdAt=new Date,o.create(i.ComentarioForm).success(function(e){r.set(e,"success"),i.necesidad.comentarios.push(i.ComentarioForm)}).error(function(e){r.set(e,"error")})},i["delete"]=function(){var t=confirm("Realmente deseas eliminar esta publicaciÃ³n?");t&&e["delete"](i.necesidad.id).success(function(e){r.set(e,"success"),n.location="#/"}).error(function(e){r.set(e,"error")})}}])}(),function(){"use strict";angular.module("app.necesidad",["app.necesidad.service","app.necesidad.nueva","app.necesidad.detalle","app.necesidad.categoria","app.comentario.service"]).controller("NecesidadesCtrl",["Necesidad","ngNotify",function(e,r){var t=this;e.load().success(function(e){t.necesidades=e}).error(function(e){r.set(e,"error")})}])}(),function(){"use strict";angular.module("app.necesidad.service",[]).factory("Necesidad",["$http",function(e){return{load:function(r){return e.get("/api/necesidades")},show:function(r){return e.get("/api/necesidades/"+r)},categoria:function(r){return e.get("/api/categorias/"+r)},"delete":function(r){return e["delete"]("/api/necesidades/"+r)},create:function(r){return e({data:r,method:"POST",url:"/api/necesidades"})},update:function(r){return e({data:r,method:"PUT",url:"/api/necesidades/"+r.id})}}}])}(),function(){"use strict";angular.module("app.necesidad.nueva",[]).controller("NuevaNecesidadCtrl",["Necesidad","ngNotify","$window",function(e,r,t){var n=this;n.NecesidadForm={},n.create=function(){e.create(n.NecesidadForm).success(function(e){r.set(e,"success"),t.location="#/necesidad/"+e}).error(function(e){r.set(e,"error")})}}])}(),angular.module("app.directives",[]).directive("money",function(){function e(e,t,n,o){function i(e){var r=Math.pow(10,l);return Math.round(e*r)/r}function a(e){return parseFloat(e).toFixed(l)}function s(e){return o.$isEmpty(e)?"":""+e}var c,u=parseFloat(n.min||0),l=parseFloat(n.precision||2);o.$parsers.push(function(e){angular.isUndefined(e)&&(e=""),0===e.indexOf(".")&&(e="0"+e),0===e.indexOf("-")&&(u>=0?(e=null,o.$setViewValue(""),o.$render()):"-"===e&&(e=""));var t=o.$isEmpty(e);return t||r.test(e)?c=""===e?null:t?e:parseFloat(e):(o.$setViewValue(s(c)),o.$render()),o.$setValidity("number",!0),c}),o.$formatters.push(s);var d=function(e){return!o.$isEmpty(e)&&u>e?void o.$setValidity("min",!1):(o.$setValidity("min",!0),e)};if(o.$parsers.push(d),o.$formatters.push(d),n.max){var p=parseFloat(n.max),f=function(e){return!o.$isEmpty(e)&&e>p?void o.$setValidity("max",!1):(o.$setValidity("max",!0),e)};o.$parsers.push(f),o.$formatters.push(f)}l>-1&&(o.$parsers.push(function(e){return e?i(e):e}),o.$formatters.push(function(e){return e?a(e):e})),t.bind("blur",function(){var e=o.$modelValue;e&&(o.$viewValue=a(e),o.$render())})}var r=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:e}}).directive("numbersOnly",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,n){n.$parsers.push(function(e){if(void 0===e)return"";var r=e.replace(/[^0-9+.]/g,"");return r!==e&&(n.$setViewValue(r),n.$render()),r})}}}),angular.module("app.filters",[]).filter("dinero",["$filter","$locale",function(e,r){var t=e("currency"),n=r.NUMBER_FORMATS;return function(e,r,o){0===r&&(r=-1);var i=t(e,o),a=i.indexOf(n.DECIMAL_SEP)+1,s="";return a<i.indexOf(n.CURRENCY_SYM)&&(s=" "+n.CURRENCY_SYM),i.substring(0,a+r)+s}}]),function(){"use strict";angular.module("app.main",["app.directives","app.filters"]).controller("MainController",["$rootScope","$scope","User",function(e,r,t){var n=this;t.me().success(function(e){n.user=e}).error(function(e){console.log(e)}),r.userAgent=navigator.userAgent,e.$on("$routeChangeStart",function(){e.loading=!0}),e.$on("$routeChangeSuccess",function(){e.loading=!1}),r.bottomReached=function(){},r.notices=[];for(var o=0;10>o;o++)r.notices.push({icon:"envelope",message:"Notice "+(o+1)});r.deleteNotice=function(e){var t=r.notices.indexOf(e);t>-1&&r.notices.splice(t,1)}}])}(),function(){"use strict";angular.module("app.user.config",[]).controller("ConfigCtrl",["ngNotify","User",function(e,r){var t=this;t.user={},console.log("Cargando"),r.me().success(function(e){t.user=e}).error(function(r){e.set(r,"error")}),t.save=function(){r.update(t.user).success(function(r){e.set(r,"success")}).error(function(r){e.set(r,"error")})}}])}(),function(){"use strict";angular.module("app.user",["app.user.service","app.user.config"]).controller("UserCtrl",["ngNotify","User","$routeParams",function(e,r,t){var n=this;console.log("Cargando"),r.show(t.id).success(function(e){n.user=e,console.log("no"),console.log(e)}).error(function(r){e.set(r,"error")})}])}(),function(){"use strict";angular.module("app.user.service",[]).factory("User",["$http",function(e){return{me:function(){return e.get("/api/users/profile")},update:function(r){return e({method:"PUT",data:r,url:"/api/users/profile"})},show:function(r){return e.get("/api/users/"+r)}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwibmVjZXNpZGFkL2NhdGVnb3JpYS5jb250cm9sbGVyLmpzIiwibmVjZXNpZGFkL2NvbWVudGFyaW8uc2VydmljZS5qcyIsIm5lY2VzaWRhZC9kZXRhbGxlLmNvbnRyb2xsZXIuanMiLCJuZWNlc2lkYWQvbmVjZXNpZGFkLmNvbnRyb2xsZXIuanMiLCJuZWNlc2lkYWQvbmVjZXNpZGFkLnNlcnZpY2UuanMiLCJuZWNlc2lkYWQvbnVldmEuY29udHJvbGxlci5qcyIsInNoYXJlZC9kaXJlY3RpdmVzLmpzIiwic2hhcmVkL2ZpbHRlcnMuanMiLCJzaGFyZWQvbWFpbi5qcyIsInVzZXJzL2NvbmZpZy5jb250cm9sbGVyLmpzIiwidXNlcnMvY29udHJvbGxlci5qcyIsInVzZXJzL3NlcnZpY2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsInJ1biIsIiR0cmFuc2Zvcm0iLCJ3aW5kb3ciLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInJlbG9hZE9uU2VhcmNoIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJOZWNlc2lkYWQiLCJuZ05vdGlmeSIsInZtIiwidGhpcyIsImxvYWQiLCJzdWNjZXNzIiwiZGF0YSIsIm5lY2VzaWRhZGVzIiwiZXJyb3IiLCJlcnIiLCJzZXQiLCIkcm91dGVQYXJhbXMiLCJjYXRlZ29yaWEiLCJjb25zb2xlIiwiZmFjdG9yeSIsIiRodHRwIiwiZGVsZXRlIiwiaWQiLCJjcmVhdGUiLCJtZXRob2QiLCJ1cmwiLCJuZWNlc2lkYWRJZCIsInVwZGF0ZSIsIiR3aW5kb3ciLCJDb21lbnRhcmlvIiwibmVjZXNpZGFkIiwiQ29tZW50YXJpb0Zvcm0iLCJzaG93Iiwic2F2ZSIsImNvbWVudGFyIiwidXNlcklkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsImNvbWVudGFyaW9zIiwicHVzaCIsInN1cmUiLCJjb25maXJtIiwibG9jYXRpb24iLCJjYWxsYmFjayIsImdldCIsImNsYXZlIiwiTmVjZXNpZGFkRm9ybSIsImRpcmVjdGl2ZSIsImxpbmsiLCJzY29wZSIsImVsIiwiYXR0cnMiLCJuZ01vZGVsQ3RybCIsInJvdW5kIiwibnVtIiwiZCIsIk1hdGgiLCJwb3ciLCJwcmVjaXNpb24iLCJmb3JtYXRQcmVjaXNpb24iLCJ2YWx1ZSIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwiZm9ybWF0Vmlld1ZhbHVlIiwiJGlzRW1wdHkiLCJsYXN0VmFsaWRWYWx1ZSIsIm1pbiIsIiRwYXJzZXJzIiwiaXNVbmRlZmluZWQiLCJpbmRleE9mIiwiJHNldFZpZXdWYWx1ZSIsIiRyZW5kZXIiLCJlbXB0eSIsIk5VTUJFUl9SRUdFWFAiLCJ0ZXN0IiwiJHNldFZhbGlkaXR5IiwiJGZvcm1hdHRlcnMiLCJtaW5WYWxpZGF0b3IiLCJtYXgiLCJtYXhWYWxpZGF0b3IiLCJiaW5kIiwiJG1vZGVsVmFsdWUiLCIkdmlld1ZhbHVlIiwicmVzdHJpY3QiLCJyZXF1aXJlIiwiZWxlbWVudCIsIm1vZGVsQ3RybCIsImlucHV0VmFsdWUiLCJ1bmRlZmluZWQiLCJ0cmFuc2Zvcm1lZElucHV0IiwicmVwbGFjZSIsImZpbHRlciIsImxvY2FsZSIsImN1cnJlbmN5RmlsdGVyIiwiZm9ybWF0cyIsIk5VTUJFUl9GT1JNQVRTIiwiYW1vdW50IiwiY3VycmVuY3lTeW1ib2wiLCJzZXAiLCJERUNJTUFMX1NFUCIsInN5bWJvbCIsIkNVUlJFTkNZX1NZTSIsInN1YnN0cmluZyIsIiRyb290U2NvcGUiLCIkc2NvcGUiLCJVc2VyIiwibWUiLCJ1c2VyIiwibG9nIiwidXNlckFnZW50IiwibmF2aWdhdG9yIiwiJG9uIiwibG9hZGluZyIsImJvdHRvbVJlYWNoZWQiLCJub3RpY2VzIiwiaiIsImljb24iLCJtZXNzYWdlIiwiZGVsZXRlTm90aWNlIiwibm90aWNlIiwiaW5kZXgiLCJzcGxpY2UiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0Es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LFlBQ0FqSSxTQUFBQyxPQUFBLHNCQUNBUyxXQUFBLGNBQUEsV0FBQSxPQUFBLFNBQUFLLEVBQUFtRyxHQUVBLEdBQUFsRyxHQUFBQyxJQUNBRCxHQUFBb0csUUFDQXpGLFFBQUEwRixJQUFBLFlBRUFILEVBQUFDLEtBQ0FoRyxRQUFBLFNBQUFDLEdBQ0FKLEVBQUFvRyxLQUFBaEcsSUFFQUUsTUFBQSxTQUFBQyxHQUNBUixFQUFBUyxJQUFBRCxFQUFBLFdBR0FQLEVBQUEwQixLQUFBLFdBQ0F3RSxFQUFBOUUsT0FBQXBCLEVBQUFvRyxNQUNBakcsUUFBQSxTQUFBQyxHQUNBTCxFQUFBUyxJQUFBSixFQUFBLGFBRUFFLE1BQUEsU0FBQUMsR0FDQVIsRUFBQVMsSUFBQUQsRUFBQSxrQkN2QkEsV0FDQSxZQUNBdkIsU0FBQUMsT0FBQSxZQUNBLG1CQUNBLG9CQUVBUyxXQUFBLFlBQUEsV0FBQSxPQUFBLGVBQUEsU0FBQUssRUFBQW1HLEVBQUF6RixHQUVBLEdBQUFULEdBQUFDLElBQ0FVLFNBQUEwRixJQUFBLFlBRUFILEVBQUF6RSxLQUFBaEIsRUFBQU0sSUFDQVosUUFBQSxTQUFBQyxHQUNBSixFQUFBb0csS0FBQWhHLEVBQ0FPLFFBQUEwRixJQUFBLE1BQ0ExRixRQUFBMEYsSUFBQWpHLEtBRUFFLE1BQUEsU0FBQUMsR0FDQVIsRUFBQVMsSUFBQUQsRUFBQSxpQkNsQkEsV0FDQSxZQUNBdkIsU0FDQUMsT0FBQSx1QkFFQTJCLFFBQUEsUUFBQSxRQUFBLFNBQUFDLEdBRUEsT0FDQXNGLEdBQUEsV0FDQSxNQUFBdEYsR0FBQXdCLElBQUEsdUJBRUFqQixPQUFBLFNBQUFoQixHQUNBLE1BQUFTLElBQ0FJLE9BQUEsTUFDQWIsS0FBQUEsRUFDQWMsSUFBQSx3QkFHQU8sS0FBQSxTQUFBVixHQUNBLE1BQUFGLEdBQUF3QixJQUFBLGNBQUF0QiIsImZpbGUiOiJidWlsZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJywgW1xuICAgICAgJ25nUm91dGUnLFxuICAgICAgJ21vYmlsZS1hbmd1bGFyLXVpJyxcbiAgICAgICdhcHAubWFpbicsXG4gICAgICAnYXBwLmhvbWUnLFxuICAgICAgJ25nTm90aWZ5JyxcbiAgICAgICdhcHAudXNlcicsXG4gICAgICAnYXBwLm5lY2VzaWRhZCcsXG4gICAgICAvLyB0b3VjaC9kcmFnIGZlYXR1cmU6IHRoaXMgaXMgZnJvbSAnbW9iaWxlLWFuZ3VsYXItdWkuZ2VzdHVyZXMuanMnXG4gICAgICAvLyBpdCBpcyBhdCBhIHZlcnkgYmVnaW5uaW5nIHN0YWdlLCBzbyBwbGVhc2UgYmUgY2FyZWZ1bCBpZiB5b3UgbGlrZSB0byB1c2VcbiAgICAgIC8vIGluIHByb2R1Y3Rpb24uIFRoaXMgaXMgaW50ZW5kZWQgdG8gcHJvdmlkZSBhIGZsZXhpYmxlLCBpbnRlZ3JhdGVkIGFuZCBhbmRcbiAgICAgIC8vIGVhc3kgdG8gdXNlIGFsdGVybmF0aXZlIHRvIG90aGVyIDNyZCBwYXJ0eSBsaWJzIGxpa2UgaGFtbWVyLmpzLCB3aXRoIHRoZVxuICAgICAgLy8gZmluYWwgcG91cnBvc2UgdG8gaW50ZWdyYXRlIGdlc3R1cmVzIGludG8gZGVmYXVsdCB1aSBpbnRlcmFjdGlvbnMgbGlrZVxuICAgICAgLy8gb3BlbmluZyBzaWRlYmFycywgdHVybmluZyBzd2l0Y2hlcyBvbi9vZmYgLi5cbiAgICAgICdtb2JpbGUtYW5ndWxhci11aS5nZXN0dXJlcydcbiAgICBdKVxuICAgIC5ydW4oWyckdHJhbnNmb3JtJyxmdW5jdGlvbigkdHJhbnNmb3JtKSB7XG4gICAgICB3aW5kb3cuJHRyYW5zZm9ybSA9ICR0cmFuc2Zvcm07XG4gICAgfV0pXG4gICAgLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJyxmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy9ob21lL3Njcm9sbC5odG1sJyxcbiAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UsXG4gICAgICAgICAgY29udHJvbGxlcjonSG9tZUN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonSG9tZUN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvbmVjZXNpZGFkLzppZCcsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvbmVjZXNpZGFkL2RldGFsbGUuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjonTmVjZXNpZGFkRGV0YWxsZUN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonRGV0YWxsZUN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvbmVjZXNpZGFkLzppZC9lZGl0YXInLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL25lY2VzaWRhZC9lZGl0YXIuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjonTmVjZXNpZGFkRGV0YWxsZUN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonRGV0YWxsZUN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvY2F0ZWdvcmlhLzpjYXRlZ29yaWEnLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL25lY2VzaWRhZC9jYXRlZ29yaWEuaHRtbCcsXG4gICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlLFxuICAgICAgICAgIGNvbnRyb2xsZXI6J0NhdGVnb3JpYUN0cmwnLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczonQ2F0ZWdvcmlhQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLndoZW4oJy9wZXJmaWwnLCB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdzY3JpcHRzL3VzZXJzL2NvbmZpZy5odG1sJyxcbiAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UsXG4gICAgICAgICAgY29udHJvbGxlcjonQ29uZmlnQ3RybCcsXG4gICAgICAgICAgY29udHJvbGxlckFzOidDb25maWdDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAud2hlbignL3VzdWFyaW8vOmlkJywge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2NyaXB0cy91c2Vycy9wcm9maWxlLmh0bWwnLFxuICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZSxcbiAgICAgICAgICBjb250cm9sbGVyOidVc2VyQ3RybCcsXG4gICAgICAgICAgY29udHJvbGxlckFzOidVc2VyQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLndoZW4oJy9jb250YWN0bycsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvc2hhcmVkL2NvbnRhY3RvLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVuKCcvcHJpdmFjaWRhZCcsIHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NjcmlwdHMvc2hhcmVkL3ByaXZhY2lkYWQuaHRtbCcgICAgICAgICAgXG4gICAgICAgIH0pXG4gICAgICAgIC5vdGhlcndpc2Uoe1xuICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICB9KTtcbiAgICB9XSk7XG5cblxuICAgIC8vIGFwcC5kaXJlY3RpdmUoJ3RvdWNoYXJlYScsIFsnJHRvdWNoJywgZnVuY3Rpb24oJHRvdWNoKXtcbiAgICAvLyAgIC8vIFJ1bnMgZHVyaW5nIGNvbXBpbGVcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIHJlc3RyaWN0OiAnQycsXG4gICAgLy8gICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgZWxlbSkge1xuICAgIC8vICAgICAgICRzY29wZS50b3VjaCA9IG51bGw7XG4gICAgLy8gICAgICAgJHRvdWNoLmJpbmQoZWxlbSwge1xuICAgIC8vICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKHRvdWNoKSB7XG4gICAgLy8gICAgICAgICAgICRzY29wZS50b3VjaCA9IHRvdWNoO1xuICAgIC8vICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgLy8gICAgICAgICB9LFxuICAgIC8vXG4gICAgLy8gICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKHRvdWNoKSB7XG4gICAgLy8gICAgICAgICAgICRzY29wZS50b3VjaCA9IHRvdWNoO1xuICAgIC8vICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgLy8gICAgICAgICB9LFxuICAgIC8vXG4gICAgLy8gICAgICAgICBtb3ZlOiBmdW5jdGlvbih0b3VjaCkge1xuICAgIC8vICAgICAgICAgICAkc2NvcGUudG91Y2ggPSB0b3VjaDtcbiAgICAvLyAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgIC8vICAgICAgICAgfSxcbiAgICAvL1xuICAgIC8vICAgICAgICAgZW5kOiBmdW5jdGlvbih0b3VjaCkge1xuICAgIC8vICAgICAgICAgICAkc2NvcGUudG91Y2ggPSB0b3VjaDtcbiAgICAvLyAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICAgIH0pO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9O1xuICAgIC8vIH1dKTtcbiAgICAvL1xuICAgIC8vIC8vXG4gICAgLy8gLy8gYCRkcmFnYCBleGFtcGxlOiBkcmFnIHRvIGRpc21pc3NcbiAgICAvLyAvL1xuICAgIC8vIGFwcC5kaXJlY3RpdmUoJ2RyYWdUb0Rpc21pc3MnLCBmdW5jdGlvbigkZHJhZywgJHBhcnNlLCAkdGltZW91dCl7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICByZXN0cmljdDogJ0EnLFxuICAgIC8vICAgICBjb21waWxlOiBmdW5jdGlvbihlbGVtLCBhdHRycykge1xuICAgIC8vICAgICAgIHZhciBkaXNtaXNzRm4gPSAkcGFyc2UoYXR0cnMuZHJhZ1RvRGlzbWlzcyk7XG4gICAgLy8gICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtKXtcbiAgICAvLyAgICAgICAgIHZhciBkaXNtaXNzID0gZmFsc2U7XG4gICAgLy9cbiAgICAvLyAgICAgICAgICRkcmFnLmJpbmQoZWxlbSwge1xuICAgIC8vICAgICAgICAgICB0cmFuc2Zvcm06ICRkcmFnLlRSQU5TTEFURV9SSUdIVCxcbiAgICAvLyAgICAgICAgICAgbW92ZTogZnVuY3Rpb24oZHJhZykge1xuICAgIC8vICAgICAgICAgICAgIGlmKCBkcmFnLmRpc3RhbmNlWCA+PSBkcmFnLnJlY3Qud2lkdGggLyA0KSB7XG4gICAgLy8gICAgICAgICAgICAgICBkaXNtaXNzID0gdHJ1ZTtcbiAgICAvLyAgICAgICAgICAgICAgIGVsZW0uYWRkQ2xhc3MoJ2Rpc21pc3MnKTtcbiAgICAvLyAgICAgICAgICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgICAgICAgZGlzbWlzcyA9IGZhbHNlO1xuICAgIC8vICAgICAgICAgICAgICAgZWxlbS5yZW1vdmVDbGFzcygnZGlzbWlzcycpO1xuICAgIC8vICAgICAgICAgICAgIH1cbiAgICAvLyAgICAgICAgICAgfSxcbiAgICAvLyAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgICAgIGVsZW0ucmVtb3ZlQ2xhc3MoJ2Rpc21pc3MnKTtcbiAgICAvLyAgICAgICAgICAgfSxcbiAgICAvLyAgICAgICAgICAgZW5kOiBmdW5jdGlvbihkcmFnKSB7XG4gICAgLy8gICAgICAgICAgICAgaWYgKGRpc21pc3MpIHtcbiAgICAvLyAgICAgICAgICAgICAgIGVsZW0uYWRkQ2xhc3MoJ2Rpc21pdHRlZCcpO1xuICAgIC8vICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgICAgICAgICAgICAgICBkaXNtaXNzRm4oc2NvcGUpO1xuICAgIC8vICAgICAgICAgICAgICAgICB9KTtcbiAgICAvLyAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgLy8gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgICAgICAgIGRyYWcucmVzZXQoKTtcbiAgICAvLyAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICAgIH1cbiAgICAvLyAgICAgICAgIH0pO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG4gICAgLy9cbiAgICAvLyAvL1xuICAgIC8vIC8vIEFub3RoZXIgYCRkcmFnYCB1c2FnZSBleGFtcGxlOiB0aGlzIGlzIGhvdyB5b3UgY291bGQgY3JlYXRlXG4gICAgLy8gLy8gYSB0b3VjaCBlbmFibGVkIFwiZGVjayBvZiBjYXJkc1wiIGNhcm91c2VsLiBTZWUgYGNhcm91c2VsLmh0bWxgIGZvciBtYXJrdXAuXG4gICAgLy8gLy9cbiAgICAvLyBhcHAuZGlyZWN0aXZlKCdjYXJvdXNlbCcsIGZ1bmN0aW9uKCl7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICByZXN0cmljdDogJ0MnLFxuICAgIC8vICAgICBzY29wZToge30sXG4gICAgLy8gICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAgIHRoaXMuaXRlbUNvdW50ID0gMDtcbiAgICAvLyAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBudWxsO1xuICAgIC8vXG4gICAgLy8gICAgICAgdGhpcy5hZGRJdGVtID0gZnVuY3Rpb24oKXtcbiAgICAvLyAgICAgICAgIHZhciBuZXdJZCA9IHRoaXMuaXRlbUNvdW50Kys7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLml0ZW1Db3VudCA9PT0gMSA/IG5ld0lkIDogdGhpcy5hY3RpdmVJdGVtO1xuICAgIC8vICAgICAgICAgcmV0dXJuIG5ld0lkO1xuICAgIC8vICAgICAgIH07XG4gICAgLy9cbiAgICAvLyAgICAgICB0aGlzLm5leHQgPSBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgdGhpcy5hY3RpdmVJdGVtID0gdGhpcy5hY3RpdmVJdGVtIHx8IDA7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLmFjdGl2ZUl0ZW0gPT09IHRoaXMuaXRlbUNvdW50IC0gMSA/IDAgOiB0aGlzLmFjdGl2ZUl0ZW0gKyAxO1xuICAgIC8vICAgICAgIH07XG4gICAgLy9cbiAgICAvLyAgICAgICB0aGlzLnByZXYgPSBmdW5jdGlvbigpe1xuICAgIC8vICAgICAgICAgdGhpcy5hY3RpdmVJdGVtID0gdGhpcy5hY3RpdmVJdGVtIHx8IDA7XG4gICAgLy8gICAgICAgICB0aGlzLmFjdGl2ZUl0ZW0gPSB0aGlzLmFjdGl2ZUl0ZW0gPT09IDAgPyB0aGlzLml0ZW1Db3VudCAtIDEgOiB0aGlzLmFjdGl2ZUl0ZW0gLSAxO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG5cblxuXG4gICAgLy9cbiAgICAvLyBGb3IgdGhpcyB0cml2aWFsIGRlbW8gd2UgaGF2ZSBqdXN0IGEgdW5pcXVlIE1haW5Db250cm9sbGVyXG4gICAgLy8gZm9yIGV2ZXJ5dGhpbmdcbiAgICAvL1xuICAgIC8vIGFwcC5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSl7XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5zd2lwZWQgPSBmdW5jdGlvbihkaXJlY3Rpb24pIHtcbiAgICAvLyAgICAgYWxlcnQoJ1N3aXBlZCAnICsgZGlyZWN0aW9uKTtcbiAgICAvLyAgIH07XG4gICAgLy9cbiAgICAvLyAgIC8vIFVzZXIgYWdlbnQgZGlzcGxheWVkIGluIGhvbWUgcGFnZVxuICAgIC8vICAgJHNjb3BlLnVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgLy9cbiAgICAvLyAgIC8vIE5lZWRlZCBmb3IgdGhlIGxvYWRpbmcgc2NyZWVuXG4gICAgLy8gICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbigpe1xuICAgIC8vICAgICAkcm9vdFNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgIC8vICAgfSk7XG4gICAgLy9cbiAgICAvLyAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKXtcbiAgICAvLyAgICAgJHJvb3RTY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgLy8gICB9KTtcbiAgICAvL1xuICAgIC8vICAgLy8gRmFrZSB0ZXh0IGkgdXNlZCBoZXJlIGFuZCB0aGVyZS5cbiAgICAvLyAgICRzY29wZS5sb3JlbSA9ICdMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzaWNpbmcgZWxpdC4gVmVsIGV4cGxpY2FibywgYWxpcXVpZCBlYXF1ZSBzb2x1dGEgbmloaWwgZWxpZ2VuZGkgYWRpcGlzY2kgZXJyb3IsIGlsbHVtIGNvcnJ1cHRpIG5hbSBmdWdhIG9tbmlzIHF1b2QgcXVhZXJhdCBtb2xsaXRpYSBleHBlZGl0YSBpbXBlZGl0IGRvbG9yZXMgaXBzYW0uIE9iY2FlY2F0aS4nO1xuICAgIC8vXG4gICAgLy8gICAvL1xuICAgIC8vICAgLy8gJ1Njcm9sbCcgc2NyZWVuXG4gICAgLy8gICAvL1xuICAgIC8vICAgdmFyIHNjcm9sbEl0ZW1zID0gW107XG4gICAgLy9cbiAgICAvLyAgIGZvciAodmFyIGk9MTsgaTw9MTAwOyBpKyspIHtcbiAgICAvLyAgICAgc2Nyb2xsSXRlbXMucHVzaCgnSXRlbSAnICsgaSk7XG4gICAgLy8gICB9XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5zY3JvbGxJdGVtcyA9IHNjcm9sbEl0ZW1zO1xuICAgIC8vXG4gICAgLy8gICAkc2NvcGUuYm90dG9tUmVhY2hlZCA9IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAvKiBnbG9iYWwgYWxlcnQ6IGZhbHNlOyAqL1xuICAgIC8vICAgICBhbGVydCgnQ29uZ3JhdHMgeW91IHNjcm9sbGVkIHRvIHRoZSBlbmQgb2YgdGhlIGxpc3QhJyk7XG4gICAgLy8gICB9O1xuICAgIC8vXG4gICAgLy8gICAvL1xuICAgIC8vICAgLy8gUmlnaHQgU2lkZWJhclxuICAgIC8vICAgLy9cbiAgICAvLyAgICRzY29wZS5jaGF0VXNlcnMgPSBbXG4gICAgLy8gICAgIHsgbmFtZTogJ0NhcmxvcyAgRmxvd2VycycsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdCeXJvbiBUYXlsb3InLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmFuYSAgVGVycnknLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnRGFycnlsICBTdG9uZScsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdGYW5uaWUgIENhcmxzb24nLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSG9sbHkgTmd1eWVuJywgb25saW5lOiB0cnVlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0JpbGwgIENoYXZleicsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdWZXJvbmljYSAgTWF4d2VsbCcsIG9ubGluZTogdHJ1ZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdKZXNzaWNhIFdlYnN0ZXInLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmFja2llICBCYXJ0b24nLCBvbmxpbmU6IHRydWUgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnQ3J5c3RhbCBEcmFrZScsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnTWlsdG9uICBEZWFuJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdKb2FubiBKb2huc3RvbicsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnQ29yYSAgVmF1Z2huJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdOaW5hICBCcmlnZ3MnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0Nhc2V5IFR1cm5lcicsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnSmltbWllICBXaWxzb24nLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ05hdGhhbmllbCBTdGVlbGUnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0F1YnJleSAgQ29sZScsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnRG9ubmllICBTdW1tZXJzJywgb25saW5lOiBmYWxzZSB9LFxuICAgIC8vICAgICB7IG5hbWU6ICdLYXRlICBNeWVycycsIG9ubGluZTogZmFsc2UgfSxcbiAgICAvLyAgICAgeyBuYW1lOiAnUHJpc2NpbGxhIEhhd2tpbnMnLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0pvZSBCYXJrZXInLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0xlZSBOb3JtYW4nLCBvbmxpbmU6IGZhbHNlIH0sXG4gICAgLy8gICAgIHsgbmFtZTogJ0Vib255IFJpY2UnLCBvbmxpbmU6IGZhbHNlIH1cbiAgICAvLyAgIF07XG4gICAgLy9cbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyAnRm9ybXMnIHNjcmVlblxuICAgIC8vICAgLy9cbiAgICAvLyAgICRzY29wZS5yZW1lbWJlck1lID0gdHJ1ZTtcbiAgICAvLyAgICRzY29wZS5lbWFpbCA9ICdtZUBleGFtcGxlLmNvbSc7XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICBhbGVydCgnWW91IHN1Ym1pdHRlZCB0aGUgbG9naW4gZm9ybScpO1xuICAgIC8vICAgfTtcbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyAnRHJhZycgc2NyZWVuXG4gICAgLy8gICAvL1xuICAgIC8vICAgJHNjb3BlLm5vdGljZXMgPSBbXTtcbiAgICAvL1xuICAgIC8vICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgLy8gICAgICRzY29wZS5ub3RpY2VzLnB1c2goe2ljb246ICdlbnZlbG9wZScsIG1lc3NhZ2U6ICdOb3RpY2UgJyArIChqICsgMSkgfSk7XG4gICAgLy8gICB9XG4gICAgLy9cbiAgICAvLyAgICRzY29wZS5kZWxldGVOb3RpY2UgPSBmdW5jdGlvbihub3RpY2UpIHtcbiAgICAvLyAgICAgdmFyIGluZGV4ID0gJHNjb3BlLm5vdGljZXMuaW5kZXhPZihub3RpY2UpO1xuICAgIC8vICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgIC8vICAgICAgICRzY29wZS5ub3RpY2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH07XG4gICAgLy8gfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAuaG9tZScsW10pXG4gICAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLFsnTmVjZXNpZGFkJywnbmdOb3RpZnknLGZ1bmN0aW9uIChOZWNlc2lkYWQsbmdOb3RpZnkpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIE5lY2VzaWRhZC5sb2FkKClcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICB2bS5uZWNlc2lkYWRlcyA9IGRhdGE7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwgJ2Vycm9yJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAubmVjZXNpZGFkLmNhdGVnb3JpYScsW10pXG4gICAgICAuY29udHJvbGxlcignQ2F0ZWdvcmlhQ3RybCcsWydOZWNlc2lkYWQnLCckcm91dGVQYXJhbXMnLGZ1bmN0aW9uIChOZWNlc2lkYWQsJHJvdXRlUGFyYW1zKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuXG5cbiAgICAgICAgTmVjZXNpZGFkLmNhdGVnb3JpYSgkcm91dGVQYXJhbXMuY2F0ZWdvcmlhKVxuICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2bS5uZWNlc2lkYWRlcyA9IGRhdGEubmVjZXNpZGFkZXM7XG4gICAgICAgICAgICB2bS5jYXRlZ29yaWEgPSBkYXRhLmNhdGVnb3JpYTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAuY29tZW50YXJpby5zZXJ2aWNlJyxbXSlcbiAgICAgIC5mYWN0b3J5KCdDb21lbnRhcmlvJyxbJyRodHRwJyxmdW5jdGlvbiAoJGh0dHApIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRlbGV0ZTpmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvY29tZW50YXJpb3MvJyArIGlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZTpmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgZGF0YSAgICA6ICBkYXRhLFxuICAgICAgICAgICAgICBtZXRob2QgIDogJ1BPU1QnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvbmVjZXNpZGFkZXMvJyArIGRhdGEubmVjZXNpZGFkSWQgKyAnL2NvbWVudGFyaW9zJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cGRhdGU6ZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgIGRhdGEgICAgOiAgZGF0YSxcbiAgICAgICAgICAgICAgbWV0aG9kICA6ICdQVVQnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvY29tZW50YXJpb3MvJyArIGRhdGEuaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9XSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAubmVjZXNpZGFkLmRldGFsbGUnLFtdKVxuICAgICAgLmNvbnRyb2xsZXIoJ05lY2VzaWRhZERldGFsbGVDdHJsJyxbJ05lY2VzaWRhZCcsJ25nTm90aWZ5JywnJHJvdXRlUGFyYW1zJywnJHdpbmRvdycsJ0NvbWVudGFyaW8nLGZ1bmN0aW9uIChOZWNlc2lkYWQsbmdOb3RpZnksJHJvdXRlUGFyYW1zLCR3aW5kb3csQ29tZW50YXJpbykge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLm5lY2VzaWRhZCA9IHt9O1xuICAgICAgICB2bS5Db21lbnRhcmlvRm9ybSA9IHt9O1xuXG4gICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICBOZWNlc2lkYWQuc2hvdygkcm91dGVQYXJhbXMuaWQpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICB2bS5uZWNlc2lkYWQgPSBkYXRhO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgTmVjZXNpZGFkLnVwZGF0ZSh2bS5uZWNlc2lkYWQpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZGF0YSwnc3VjY2VzcycpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jb21lbnRhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2bS5Db21lbnRhcmlvRm9ybS5uZWNlc2lkYWRJZCA9IHZtLm5lY2VzaWRhZC5pZDtcbiAgICAgICAgICB2bS5Db21lbnRhcmlvRm9ybS51c2VySWQgPSB2bS5uZWNlc2lkYWQudXNlcklkO1xuICAgICAgICAgIHZtLkNvbWVudGFyaW8uY3JlYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAgIENvbWVudGFyaW8uY3JlYXRlKHZtLkNvbWVudGFyaW9Gb3JtKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGRhdGEsJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgdm0ubmVjZXNpZGFkLmNvbWVudGFyaW9zLnB1c2godm0uQ29tZW50YXJpb0Zvcm0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHN1cmUgPSBjb25maXJtKCdSZWFsbWVudGUgZGVzZWFzIGVsaW1pbmFyIGVzdGEgcHVibGljYWNpw7NuPycpO1xuICAgICAgICAgIGlmIChzdXJlKSB7XG4gICAgICAgICAgICBOZWNlc2lkYWQuZGVsZXRlKHZtLm5lY2VzaWRhZC5pZClcbiAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBuZ05vdGlmeS5zZXQoZGF0YSwnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24gPSAnIy8nO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuXG4gICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwLm5lY2VzaWRhZCcsW1xuICAgICAgJ2FwcC5uZWNlc2lkYWQuc2VydmljZScsXG4gICAgICAnYXBwLm5lY2VzaWRhZC5udWV2YScsXG4gICAgICAnYXBwLm5lY2VzaWRhZC5kZXRhbGxlJyxcbiAgICAgICdhcHAubmVjZXNpZGFkLmNhdGVnb3JpYScsXG4gICAgICAnYXBwLmNvbWVudGFyaW8uc2VydmljZSdcbiAgICBdKVxuICAgICAgLmNvbnRyb2xsZXIoJ05lY2VzaWRhZGVzQ3RybCcsWydOZWNlc2lkYWQnLCduZ05vdGlmeScsZnVuY3Rpb24gKE5lY2VzaWRhZCxuZ05vdGlmeSkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgTmVjZXNpZGFkLmxvYWQoKVxuICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgIHZtLm5lY2VzaWRhZGVzID0gZGF0YTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBuZ05vdGlmeS5zZXQoZXJyLCAnZXJyb3InKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcC5uZWNlc2lkYWQuc2VydmljZScsW10pXG4gICAgICAuZmFjdG9yeSgnTmVjZXNpZGFkJyxbJyRodHRwJyxmdW5jdGlvbiAoJGh0dHApIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxvYWQ6ZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL25lY2VzaWRhZGVzJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzaG93OmZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9uZWNlc2lkYWRlcy8nICsgaWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2F0ZWdvcmlhOmZ1bmN0aW9uIChjbGF2ZSkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9jYXRlZ29yaWFzLycgKyBjbGF2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZWxldGU6ZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL25lY2VzaWRhZGVzLycgKyBpZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjcmVhdGU6ZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgIGRhdGEgICAgOiAgZGF0YSxcbiAgICAgICAgICAgICAgbWV0aG9kICA6ICdQT1NUJyxcbiAgICAgICAgICAgICAgdXJsICAgICA6ICcvYXBpL25lY2VzaWRhZGVzJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cGRhdGU6ZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgIGRhdGEgICAgOiAgZGF0YSxcbiAgICAgICAgICAgICAgbWV0aG9kICA6ICdQVVQnLFxuICAgICAgICAgICAgICB1cmwgICAgIDogJy9hcGkvbmVjZXNpZGFkZXMvJyArIGRhdGEuaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9XSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAubmVjZXNpZGFkLm51ZXZhJyxbXSlcbiAgICAgIC5jb250cm9sbGVyKCdOdWV2YU5lY2VzaWRhZEN0cmwnLFsnTmVjZXNpZGFkJywnbmdOb3RpZnknLCckd2luZG93JyxmdW5jdGlvbiAoTmVjZXNpZGFkLG5nTm90aWZ5LCR3aW5kb3dcbiAgICAgICkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLk5lY2VzaWRhZEZvcm0gPSB7fTtcblxuICAgICAgICB2bS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgTmVjZXNpZGFkLmNyZWF0ZSh2bS5OZWNlc2lkYWRGb3JtKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGRhdGEsJ3N1Y2Nlc3MnKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24gPSAnIy9uZWNlc2lkYWQvJyArIGRhdGE7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwnZXJyb3InKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICB9XSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJywgW10pXG4gIC5kaXJlY3RpdmUoJ21vbmV5JywgZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIE5VTUJFUl9SRUdFWFAgPSAvXlxccyooXFwtfFxcKyk/KFxcZCt8KFxcZCooXFwuXFxkKikpKVxccyokLztcblxuICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsLCBhdHRycywgbmdNb2RlbEN0cmwpIHtcbiAgICAgIHZhciBtaW4gPSBwYXJzZUZsb2F0KGF0dHJzLm1pbiB8fCAwKTtcbiAgICAgIHZhciBwcmVjaXNpb24gPSBwYXJzZUZsb2F0KGF0dHJzLnByZWNpc2lvbiB8fCAyKTtcbiAgICAgIHZhciBsYXN0VmFsaWRWYWx1ZTtcblxuICAgICAgZnVuY3Rpb24gcm91bmQobnVtKSB7XG4gICAgICAgIHZhciBkID0gTWF0aC5wb3coMTAsIHByZWNpc2lvbik7XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKG51bSAqIGQpIC8gZDtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZm9ybWF0UHJlY2lzaW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKS50b0ZpeGVkKHByZWNpc2lvbik7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGZvcm1hdFZpZXdWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gbmdNb2RlbEN0cmwuJGlzRW1wdHkodmFsdWUpID8gJycgOiAnJyArIHZhbHVlO1xuICAgICAgfVxuXG5cbiAgICAgIG5nTW9kZWxDdHJsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICAgIHZhbHVlID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGUgbGVhZGluZyBkZWNpbWFsIHBvaW50LCBsaWtlIFwiLjVcIlxuICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignLicpID09PSAwKSB7XG4gICAgICAgICAgdmFsdWUgPSAnMCcgKyB2YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFsbG93IFwiLVwiIGlucHV0cyBvbmx5IHdoZW4gbWluIDwgMFxuICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignLScpID09PSAwKSB7XG4gICAgICAgICAgaWYgKG1pbiA+PSAwKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKCcnKTtcbiAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnLScpIHtcbiAgICAgICAgICAgIHZhbHVlID0gJyc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGVtcHR5ID0gbmdNb2RlbEN0cmwuJGlzRW1wdHkodmFsdWUpO1xuICAgICAgICBpZiAoZW1wdHkgfHwgTlVNQkVSX1JFR0VYUC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgIGxhc3RWYWxpZFZhbHVlID0gKHZhbHVlID09PSAnJylcbiAgICAgICAgICA/IG51bGxcbiAgICAgICAgICA6IChlbXB0eSA/IHZhbHVlIDogcGFyc2VGbG9hdCh2YWx1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFJlbmRlciB0aGUgbGFzdCB2YWxpZCBpbnB1dCBpbiB0aGUgZmllbGRcbiAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKGZvcm1hdFZpZXdWYWx1ZShsYXN0VmFsaWRWYWx1ZSkpO1xuICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWYWxpZGl0eSgnbnVtYmVyJywgdHJ1ZSk7XG4gICAgICAgIHJldHVybiBsYXN0VmFsaWRWYWx1ZTtcbiAgICAgIH0pO1xuICAgICAgbmdNb2RlbEN0cmwuJGZvcm1hdHRlcnMucHVzaChmb3JtYXRWaWV3VmFsdWUpO1xuXG4gICAgICB2YXIgbWluVmFsaWRhdG9yID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgaWYgKCFuZ01vZGVsQ3RybC4kaXNFbXB0eSh2YWx1ZSkgJiYgdmFsdWUgPCBtaW4pIHtcbiAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0VmFsaWRpdHkoJ21pbicsIGZhbHNlKTtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWYWxpZGl0eSgnbWluJywgdHJ1ZSk7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgbmdNb2RlbEN0cmwuJHBhcnNlcnMucHVzaChtaW5WYWxpZGF0b3IpO1xuICAgICAgbmdNb2RlbEN0cmwuJGZvcm1hdHRlcnMucHVzaChtaW5WYWxpZGF0b3IpO1xuXG4gICAgICBpZiAoYXR0cnMubWF4KSB7XG4gICAgICAgIHZhciBtYXggPSBwYXJzZUZsb2F0KGF0dHJzLm1heCk7XG4gICAgICAgIHZhciBtYXhWYWxpZGF0b3IgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghbmdNb2RlbEN0cmwuJGlzRW1wdHkodmFsdWUpICYmIHZhbHVlID4gbWF4KSB7XG4gICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0VmFsaWRpdHkoJ21heCcsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWYWxpZGl0eSgnbWF4JywgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIG5nTW9kZWxDdHJsLiRwYXJzZXJzLnB1c2gobWF4VmFsaWRhdG9yKTtcbiAgICAgICAgbmdNb2RlbEN0cmwuJGZvcm1hdHRlcnMucHVzaChtYXhWYWxpZGF0b3IpO1xuICAgICAgfVxuXG4gICAgICAvLyBSb3VuZCBvZmZcbiAgICAgIGlmIChwcmVjaXNpb24gPiAtMSkge1xuICAgICAgICBuZ01vZGVsQ3RybC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZSA/IHJvdW5kKHZhbHVlKSA6IHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgICAgbmdNb2RlbEN0cmwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWUgPyBmb3JtYXRQcmVjaXNpb24odmFsdWUpIDogdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBlbC5iaW5kKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBuZ01vZGVsQ3RybC4kbW9kZWxWYWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgbmdNb2RlbEN0cmwuJHZpZXdWYWx1ZSA9IGZvcm1hdFByZWNpc2lvbih2YWx1ZSk7XG4gICAgICAgICAgbmdNb2RlbEN0cmwuJHJlbmRlcigpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgIGxpbms6IGxpbmtcbiAgICB9O1xuICB9KS5kaXJlY3RpdmUoJ251bWJlcnNPbmx5JywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbW9kZWxDdHJsKSB7XG4gICAgICAgIG1vZGVsQ3RybC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uIChpbnB1dFZhbHVlKSB7XG4gICAgICAgICAgLy8gdGhpcyBuZXh0IGlmIGlzIG5lY2Vzc2FyeSBmb3Igd2hlbiB1c2luZyBuZy1yZXF1aXJlZCBvbiB5b3VyIGlucHV0LlxuICAgICAgICAgIC8vIEluIHN1Y2ggY2FzZXMsIHdoZW4gYSBsZXR0ZXIgaXMgdHlwZWQgZmlyc3QsIHRoaXMgcGFyc2VyIHdpbGwgYmUgY2FsbGVkXG4gICAgICAgICAgLy8gYWdhaW4sIGFuZCB0aGUgMm5kIHRpbWUsIHRoZSB2YWx1ZSB3aWxsIGJlIHVuZGVmaW5lZFxuICAgICAgICAgIGlmIChpbnB1dFZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybiAnJztcbiAgICAgICAgICB2YXIgdHJhbnNmb3JtZWRJbnB1dCA9IGlucHV0VmFsdWUucmVwbGFjZSgvW14wLTkrLl0vZywgJycpO1xuICAgICAgICAgIGlmICh0cmFuc2Zvcm1lZElucHV0IT09aW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgbW9kZWxDdHJsLiRzZXRWaWV3VmFsdWUodHJhbnNmb3JtZWRJbnB1dCk7XG4gICAgICAgICAgICBtb2RlbEN0cmwuJHJlbmRlcigpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZElucHV0O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVycycsW10pXG4gIC5maWx0ZXIoJ2RpbmVybycsXG4gIFsgJyRmaWx0ZXInLCAnJGxvY2FsZScsIGZ1bmN0aW9uKGZpbHRlciwgbG9jYWxlKSB7XG4gICAgdmFyIGN1cnJlbmN5RmlsdGVyID0gZmlsdGVyKCdjdXJyZW5jeScpO1xuICAgIHZhciBmb3JtYXRzID0gbG9jYWxlLk5VTUJFUl9GT1JNQVRTO1xuICAgIHJldHVybiBmdW5jdGlvbihhbW91bnQsIG51bSwgY3VycmVuY3lTeW1ib2wpIHtcbiAgICAgIGlmIChudW09PT0wKSBudW0gPSAtMTtcbiAgICAgIHZhciB2YWx1ZSA9IGN1cnJlbmN5RmlsdGVyKGFtb3VudCwgY3VycmVuY3lTeW1ib2wpO1xuICAgICAgdmFyIHNlcCA9IHZhbHVlLmluZGV4T2YoZm9ybWF0cy5ERUNJTUFMX1NFUCkrMTtcbiAgICAgIHZhciBzeW1ib2wgPSAnJztcbiAgICAgIGlmIChzZXA8dmFsdWUuaW5kZXhPZihmb3JtYXRzLkNVUlJFTkNZX1NZTSkpIHN5bWJvbCA9ICcgJytmb3JtYXRzLkNVUlJFTkNZX1NZTTtcbiAgICAgIHJldHVybiB2YWx1ZS5zdWJzdHJpbmcoMCwgc2VwK251bSkrc3ltYm9sO1xuICAgIH07XG4gIH0gXSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gICAgYW5ndWxhclxuICAgICAgLm1vZHVsZSgnYXBwLm1haW4nLCBbXG4gICAgICAnYXBwLmRpcmVjdGl2ZXMnLFxuICAgICAgJ2FwcC5maWx0ZXJzJ1xuICAgIF0pXG4gICAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJyxbJyRyb290U2NvcGUnLCckc2NvcGUnLCdVc2VyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCBVc2VyKXtcblxuICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgVXNlci5tZSgpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgdm0udXNlciA9IGRhdGE7XG4gICAgICAgIH0pXG4gICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8vIFVzZXIgYWdlbnQgZGlzcGxheWVkIGluIGhvbWUgcGFnZVxuICAgICAgJHNjb3BlLnVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG5cbiAgICAgIC8vIE5lZWRlZCBmb3IgdGhlIGxvYWRpbmcgc2NyZWVuXG4gICAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbigpe1xuICAgICAgICAkcm9vdFNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKXtcbiAgICAgICAgJHJvb3RTY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB9KTtcblxuXG5cbiAgICAgICRzY29wZS5ib3R0b21SZWFjaGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8qIGdsb2JhbCBhbGVydDogZmFsc2U7ICovXG4gICAgICAgIC8vIGFsZXJ0KCdDb25ncmF0cyB5b3Ugc2Nyb2xsZWQgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdCEnKTtcbiAgICAgIH07XG5cblxuICAgICAgLy9cbiAgICAgIC8vICdEcmFnJyBzY3JlZW5cbiAgICAgIC8vXG4gICAgICAkc2NvcGUubm90aWNlcyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgJHNjb3BlLm5vdGljZXMucHVzaCh7aWNvbjogJ2VudmVsb3BlJywgbWVzc2FnZTogJ05vdGljZSAnICsgKGogKyAxKSB9KTtcbiAgICAgIH1cblxuICAgICAgJHNjb3BlLmRlbGV0ZU5vdGljZSA9IGZ1bmN0aW9uKG5vdGljZSkge1xuICAgICAgICB2YXIgaW5kZXggPSAkc2NvcGUubm90aWNlcy5pbmRleE9mKG5vdGljZSk7XG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgJHNjb3BlLm5vdGljZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXIuY29uZmlnJywgW10pXG4gICAgLmNvbnRyb2xsZXIoJ0NvbmZpZ0N0cmwnLFsnbmdOb3RpZnknLCdVc2VyJyxmdW5jdGlvbihuZ05vdGlmeSxVc2VyKXtcblxuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLnVzZXIgPSB7fTtcbiAgICAgIGNvbnNvbGUubG9nKCdDYXJnYW5kbycpO1xuXG4gICAgICBVc2VyLm1lKClcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gIChkYXRhKSB7XG4gICAgICAgICAgdm0udXNlciA9IGRhdGE7XG4gICAgICAgIH0pXG4gICAgICAgIC5lcnJvcihmdW5jdGlvbiAgKGVycikge1xuICAgICAgICAgIG5nTm90aWZ5LnNldChlcnIsJ2Vycm9yJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICB2bS5zYXZlID0gZnVuY3Rpb24gICgpIHtcbiAgICAgICAgVXNlci51cGRhdGUodm0udXNlcilcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGRhdGEsJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAgKGVycikge1xuICAgICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwnZXJyb3InKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfV0pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXInLCBbXG4gICAgJ2FwcC51c2VyLnNlcnZpY2UnLFxuICAgICdhcHAudXNlci5jb25maWcnIC8vIGVkaXRhciBwZXJmaWwgZGVsIHVzdWFyaW8geSBzdSBjb25maWd1cmFjacOzblxuICBdKVxuICAgIC5jb250cm9sbGVyKCdVc2VyQ3RybCcsWyduZ05vdGlmeScsJ1VzZXInLCckcm91dGVQYXJhbXMnLGZ1bmN0aW9uKG5nTm90aWZ5LFVzZXIsJHJvdXRlUGFyYW1zKXtcblxuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIGNvbnNvbGUubG9nKCdDYXJnYW5kbycpO1xuXG4gICAgICBVc2VyLnNob3coJHJvdXRlUGFyYW1zLmlkKVxuICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAgKGRhdGEpIHtcbiAgICAgICAgICAgIHZtLnVzZXIgPSBkYXRhO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ25vJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmVycm9yKGZ1bmN0aW9uICAoZXJyKSB7XG4gICAgICAgICAgbmdOb3RpZnkuc2V0KGVyciwnZXJyb3InKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAudXNlci5zZXJ2aWNlJywgIFtdKVxuXG4gICAgICAuZmFjdG9yeSAoJ1VzZXInLCBbJyRodHRwJyxmdW5jdGlvbiAoJGh0dHApIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1lOmZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvcHJvZmlsZScpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdXBkYXRlOmZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgICBtZXRob2Q6J1BVVCcsXG4gICAgICAgICAgICAgIGRhdGE6ZGF0YSxcbiAgICAgICAgICAgICAgdXJsOicvYXBpL3VzZXJzL3Byb2ZpbGUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNob3c6ZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzLycgKyBpZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfV0pO1xuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
